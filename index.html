<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>iningwei的私家宅院</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="测试description">
<meta property="og:type" content="website">
<meta property="og:title" content="iningwei的私家宅院">
<meta property="og:url" content="https://iningwei.github.io/index.html">
<meta property="og:site_name" content="iningwei的私家宅院">
<meta property="og:description" content="测试description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iningwei的私家宅院">
<meta name="twitter:description" content="测试description">
  
    <link rel="alternative" href="/atom.xml" title="iningwei的私家宅院" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.png">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/img/avatar img 256.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">iningwei</a></h1>
		</hgroup>

		
		<p class="header-subtitle">其实我是学地理的</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="#" title="github">github</a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
		        
					<a class="rss" target="_blank" href="#" title="rss">rss</a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">iningwei</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="/img/avatar img 256.png" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">iningwei</h1>
			</hgroup>
			
			<p class="header-subtitle">其实我是学地理的</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/tags/随笔">随笔</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-堆栈应用之进制转换" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/05/堆栈应用之进制转换/">堆栈应用之进制转换</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="原理说明"><a href="#原理说明" class="headerlink" title="原理说明"></a>原理说明</h1><p>以一个十进制数N=5142转换为八进制数为例，其一般的思路为辗转相除法。如下图：<br><img src="/img/covert10to8.png" alt="辗转相除法原理图"><br>5142转换为八进制后的结果为12026，从图中可以看到输出的顺序跟产生的顺序相反，这个特性符合栈的操作原则。</p>
<h1 id="C-算法实现"><a href="#C-算法实现" class="headerlink" title="C#算法实现"></a>C#算法实现</h1><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></div><div class="line">    &#123;</div><div class="line">        Console.WriteLine(<span class="string">"enter a num:"</span>);</div><div class="line">        <span class="keyword">string</span> numStr = Console.ReadLine();</div><div class="line">        <span class="keyword">int</span> num = <span class="keyword">int</span>.Parse(numStr);</div><div class="line"></div><div class="line">        Console.WriteLine(<span class="string">"转换为8进制结果为："</span> + DoConvert8(num));</div><div class="line">        Console.ReadLine();</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">string</span> <span class="title">DoConvert8</span>(<span class="params"><span class="keyword">int</span> num</span>)</span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">string</span> result = <span class="string">""</span>;</div><div class="line"></div><div class="line">        Stack&lt;<span class="keyword">int</span>&gt; resultStack = <span class="keyword">new</span> Stack&lt;<span class="keyword">int</span>&gt;();</div><div class="line">        <span class="keyword">int</span> <span class="keyword">value</span> = num;</div><div class="line">        <span class="keyword">do</span></div><div class="line">        &#123;</div><div class="line">            resultStack.Push(<span class="keyword">value</span> % <span class="number">8</span>);</div><div class="line">            <span class="keyword">value</span> = <span class="keyword">value</span> / <span class="number">8</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">value</span> != <span class="number">0</span>);</div><div class="line"></div><div class="line"></div><div class="line">        <span class="keyword">while</span> (resultStack.Count &gt; <span class="number">0</span>)</div><div class="line">        &#123;</div><div class="line">            result += resultStack.Pop().ToString();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2018/09/05/堆栈应用之进制转换/" class="archive-article-date">
  	<time datetime="2018-09-05T14:35:34.000Z" itemprop="datePublished"><i class="icon-clock"></i>2018-09-05</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/数据结构与算法/">数据结构与算法</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/数据结构与算法/">数据结构与算法</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-（转）.NET垃圾回收原理" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/04/（转）.NET垃圾回收原理/">（转）.NET垃圾回收原理</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="转自：http-mp-weixin-qq-com-s-biz-MjM5MDI5MjAyMA-amp-mid-203643791-amp-idx-1-amp-sn-f65d23bcf7e270d1e69ac9fc5f648581-amp-3rd-MzA3MDU4NTYzMw-amp-scene-6-rd-amp-utm-source-tuicool-amp-utm-medium-referral，-转载请尊重原作者成果，保留出处。"><a href="#转自：http-mp-weixin-qq-com-s-biz-MjM5MDI5MjAyMA-amp-mid-203643791-amp-idx-1-amp-sn-f65d23bcf7e270d1e69ac9fc5f648581-amp-3rd-MzA3MDU4NTYzMw-amp-scene-6-rd-amp-utm-source-tuicool-amp-utm-medium-referral，-转载请尊重原作者成果，保留出处。" class="headerlink" title="转自：http://mp.weixin.qq.com/s?__biz=MjM5MDI5MjAyMA==&amp;mid=203643791&amp;idx=1&amp;sn=f65d23bcf7e270d1e69ac9fc5f648581&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd&amp;utm_source=tuicool&amp;utm_medium=referral， 转载请尊重原作者成果，保留出处。"></a>转自：<a href="http://mp.weixin.qq.com/s?__biz=MjM5MDI5MjAyMA==&amp;mid=203643791&amp;idx=1&amp;sn=f65d23bcf7e270d1e69ac9fc5f648581&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd&amp;utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="external">http://mp.weixin.qq.com/s?__biz=MjM5MDI5MjAyMA==&amp;mid=203643791&amp;idx=1&amp;sn=f65d23bcf7e270d1e69ac9fc5f648581&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd&amp;utm_source=tuicool&amp;utm_medium=referral</a>， 转载请尊重原作者成果，保留出处。</h2><h1 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h1><h2 id="托管堆-Managed-Heap"><a href="#托管堆-Managed-Heap" class="headerlink" title="托管堆(Managed Heap)"></a>托管堆(Managed Heap)</h2><p>先来看MSDN的解释：初始化新进程时，运行时会为进程保留一个连续的地址空间区域。这个保留的地址空间被称为托管堆。</p>
<p>“托管堆也是堆”，为什么这样说呢？这么说是希望大家不要被“术语”迷惑，这个知识点的前提是“值类型和引用类型的区别”。这里假设读者已经知道“值类型存储在栈中，引用类型存储在堆中。(引用类型的引用存储在栈中)”这一重要概念。所以，根据这个理论，除值类型外，CLR要求所有资源都从托管堆分配。</p>
<p>托管堆维护着一个指针，这里命名为NextObjPtr，它指向下一个对象在堆中的分配位置。<br><img src="/img/nextObjPtr.png" alt="NextObjPtr">  </p>
<h2 id="CPU寄存器-CPU-Register"><a href="#CPU寄存器-CPU-Register" class="headerlink" title="CPU寄存器(CPU Register)"></a>CPU寄存器(CPU Register)</h2><p>这个是计算机基础知识，这里复习一下，有助于对下面“根”概念的理解。</p>
<p>CPU寄存器是CPU自己的”临时存储器”,比内存的存取还快。按与CPU远近来分，离得最近的是寄存器，然后缓存(计算机一、二、三级缓存)，最后内存。</p>
<h2 id="根-Roots"><a href="#根-Roots" class="headerlink" title="根(Roots)"></a>根(Roots)</h2><p>类中定义的任何静态字段，方法的参数，局部变量(仅限引用类型变量)等都是根，另外cpu寄存器中的对象指针也是根。根是CLR在堆之外可以找到的各种入口点。<br><img src="/img/cg_roots.png" alt="cg_roots"> </p>
<h2 id="对象可达与不可达-Objects-reachable-and-unreachable"><a href="#对象可达与不可达-Objects-reachable-and-unreachable" class="headerlink" title="对象可达与不可达(Objects reachable and unreachable)"></a>对象可达与不可达(Objects reachable and unreachable)</h2><p>如果一个根引用了堆中的一个对象，则该对象为“可达”，否则即是“不可达”。</p>
<h2 id="垃圾回收的原因"><a href="#垃圾回收的原因" class="headerlink" title="垃圾回收的原因"></a>垃圾回收的原因</h2><p>从计算机组成的角度来讲，所有的程序都是要驻留在内存中运行的。而内存是一个限制因素(大小)。除此之外，托管堆也有大小限制。如果托管堆没有大小限制，那C#的执行速度要优于c了(托管堆的结构让它有比c运行时堆更快的对象分配速度)。因为地址空间和存储的限制因素，托管堆要通过垃圾回收机制，来维持它的正常运作，保证对象的分配，不会“内存溢出”。</p>
<h2 id="垃圾回收的基本原理"><a href="#垃圾回收的基本原理" class="headerlink" title="垃圾回收的基本原理"></a>垃圾回收的基本原理</h2><p>回收分为两个阶段： 标记(mark) –&gt; 压缩(compact)</p>
<p>标记的过程，其实就是判断对象是否可达的过程。当所有的根都检查完毕后，堆中将包含可达(已标记)与不可达(未标记)对象。</p>
<p>标记完成后，进入压缩阶段。在这个阶段中，垃圾回收器线性的遍历堆，以寻找不可达对象的连续内存块。并把可达对象移动到这里以压缩堆。这个过程有点类似于磁盘空间的碎片整理。<br><img src="/img/mark_sweep.png" alt="mark compact"> </p>
<p>如上图所示，绿色框表示可达对象，黄色框为不可达对象。不可达对象清除后，移动可达对象实现内存压缩(变得更紧凑)。</p>
<p>压缩之后，“指向这些对象的指针”的变量和CPU寄存器现在都会失效，垃圾回收器必须重新访问所有根，并修改它们来指向对象的新内存位置。这会造成显著的性能损失。这个损失也是托管堆的主要缺点。</p>
<p>基于以上特点，垃圾回收引发的回收算法也是一项研究课题。因为如果真等到托管堆满才开始执行垃圾回收，那就真的太“慢”了。</p>
<h2 id="垃圾回收算法-–-分代-Generation-算法"><a href="#垃圾回收算法-–-分代-Generation-算法" class="headerlink" title="垃圾回收算法 – 分代(Generation)算法"></a>垃圾回收算法 – 分代(Generation)算法</h2><p>代是CLR垃圾回收器采用的一种机制，它唯一的目的就是提升应用程序的性能。分代回收，速度显然快于回收整个堆。</p>
<p>CLR托管堆支持3代：第0代，第1代，第2代。第0代的空间约为256KB，第1代约为2M，第2代约为10M。新构造的对象会被分配到第0代，<br><img src="/img/gc_generation0.png" alt="gc_generation0"> </p>
<p>如上图所示， 当第0代的空间满时，垃圾回收器启动回收 ，不可达对象(上图C、E)会被回收，存活的对象被归为第1代。<br><img src="/img/gc_generation1.png" alt="gc_generation1"> </p>
<p>当第0代空间已满，第1代也开始有很多不可达对象以至空间将满时，这时两代垃圾都将被回收。存活下来的对象(可达对象)，第0代升为第1代，第1代升为第2代。</p>
<p>实际CLR的代回收机制更加“智能”，如果新创建的对象生存周期很短，第0代垃圾也会立刻被垃圾回收器回收(不用等空间分配满)。另外，如果回收了第0代，发现还有很多对象“可达”，</p>
<p>并没有释放多少内存，就会增大第0代的预算至512KB，回收效果就会转变为：垃圾回收的次数将减少，但每次都会回收大量的内存。如果还没有释放多少内存，垃圾回收器将执行</p>
<p>完全回收(3代)，如果还是不够，则会抛出“内存溢出”异常。</p>
<p>也就是说，垃圾回收器会根据回收内存的大小，动态的调整每一代的分配空间预算！达到自动优化！</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>垃圾回收背后有这样一个基本的观念：编程语言(大多数的)似乎总能访问无限的内存。而开发者可以一直分配、分配再分配——像魔法一样，取之不尽用之不竭。</p>
<p>.NET垃圾回收器的基本工作原理是：通过最基本的标记清除原理，清除不可达对象；再像磁盘碎片整理一样压缩、整理可用内存；最后通过分代算法实现性能最优化。</p>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>博客园这篇文章总结的很好：<a href="http://kb.cnblogs.com/page/106720/" target="_blank" rel="external">http://kb.cnblogs.com/page/106720/</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/01/04/（转）.NET垃圾回收原理/" class="archive-article-date">
  	<time datetime="2017-01-04T08:37:32.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-01-04</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NET/">.NET</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-浅谈C#中多态的魅力（虚方法、抽象、接口实现）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/04/浅谈C#中多态的魅力（虚方法、抽象、接口实现）/">浅谈C#中多态的魅力（虚方法、抽象、接口实现）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="转载请尊重原作者iningwei成果，保留出处。https-iningwei-github-io"><a href="#转载请尊重原作者iningwei成果，保留出处。https-iningwei-github-io" class="headerlink" title="转载请尊重原作者iningwei成果，保留出处。https://iningwei.github.io"></a>转载请尊重原作者iningwei成果，保留出处。<a href="https://iningwei.github.io">https://iningwei.github.io</a></h2><p>C#中多态的实现方式一般有3种，即分别通过虚方法、抽象类、接口来实现。</p>
<p>理解多态首先要对里氏替换原则和开放封闭原则有所了解。</p>
<ul>
<li>里氏替换原则（Liskov Substitution Principle）:派生类（子类）对象能够替换其基类（超类）对象被使用。通俗一点的理解就是“子类是父类”，举个例子，“男人是人，人不一定是男人”，当需要一个父类类型的对象的时候可以给其赋予一个子类类型的对象；当需要一个子类类型对象的时候给一个父类类型对象是不可以的！</li>
<li>开放封闭原则（Open Closed Principle）：封装变化、降低耦合，软件实体应该是可扩展，而不可修改的。也就是说，对扩展是开放的，而对修改是封闭的。因此，开放封闭原则主要体现在两个方面：对扩展开放，意味着有新的需求或变化时，可以对现有代码进行扩展，以适应新的情况。对修改封闭，意味着类一旦设计完成，就可以独立完成其工作，而不要对类进行任何修改。</li>
</ul>
<h1 id="一，虚方法实现多态"><a href="#一，虚方法实现多态" class="headerlink" title="一，虚方法实现多态"></a>一，虚方法实现多态</h1><p>喜鹊（Magpie）、老鹰（Eagle）、企鹅（Penguin）都是属于鸟类，它们拥有共性吃。因此可以提取鸟类（Bird）做为父类，Eat()作为父类的虚方法。喜鹊、老鹰、企鹅分别继承Bird类，并重写父类中的Eat类，达到不同的鸟类吃的东西不一样的功能。<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Bird</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Eat</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        Console.WriteLine(<span class="string">"i am a bird,i must eat"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Magpie</span> : <span class="title">Bird</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Eat</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        Console.WriteLine(<span class="string">"我吃虫子"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Eagle</span> : <span class="title">Bird</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Eat</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        Console.WriteLine(<span class="string">"我吃肉"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Penguin</span> : <span class="title">Bird</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Eat</span>(<span class="params"></span>)</span></div><div class="line">    &#123;</div><div class="line">        Console.WriteLine(<span class="string">"我吃鱼"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">class</span> <span class="title">Program</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></div><div class="line">    &#123;</div><div class="line">        Bird[] birds =  &#123;</div><div class="line">           <span class="keyword">new</span> Bird(), <span class="keyword">new</span> Magpie(),<span class="keyword">new</span> Eagle(),<span class="keyword">new</span> Penguin()</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> birds)</div><div class="line">        &#123;</div><div class="line">            item.Eat();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>以上代码运行结果：<br><img src="/img/duotai_virtual.png" alt="&quot;虚方法多态运行结果&quot;">  </p>
<p>由此可见，子类Magpie，Eagle，Penguin对象可以赋值给父类对象，也就是说父类类型指针可以指向子类类型对象，这里体现了里氏替换原则。<br>父类对象调用自己的Eat()方法，实际上显示的是父类类型指针指向的子类类型对象重写父类Eat后的方法。这就是多态。<br>其实多态的作用就是把不同的子类对象都当作父类来看，可以屏蔽不同子类对象之间的差异，写出通用的代码，做出通用的编程，以适应需求的不断变化。<br>以上程序也体现了开放封闭原则，如果后面的同事需要扩展我这个程序，还想再添加一个猫头鹰（Owl），很容易，只需要添加一个Owl类文件，继承Bird，重写Eat()方法，添加给父类对象就可以了。至此，该程序的扩展性得到了提升，而又不需要查看源代码是如何实现的就可以扩展新功能。这就是多态带来的好处。</p>
<h1 id="二，抽象类实现多态"><a href="#二，抽象类实现多态" class="headerlink" title="二，抽象类实现多态"></a>二，抽象类实现多态</h1><p>如果我们用不到Bird父类的对象，那么可以使用抽象类来优化。把Bird改成抽象类，Eat()方法改成抽象方法。<br><figure class="highlight csharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Bird</span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Eat</span>(<span class="params"></span>)</span>;<span class="comment">//抽象方法，没有方法体。</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>喜鹊、老鹰、企鹅的代码不需要任何更改，main方法体内birds数组不再实例化抽象的Bird类。</p>
<p>至于何时使用虚方法，何时使用抽象类，需要根据具体需求，即是否需要使用基类的实例。</p>
<h1 id="三，接口实现多态"><a href="#三，接口实现多态" class="headerlink" title="三，接口实现多态"></a>三，接口实现多态</h1><p>喜鹊和老鹰能够飞翔、企鹅无法飞翔。一般而言，可以在父类Bird中定义Fly()方法。但是企鹅也继承了Bird的Fly()方法，这有点不伦不类。另外当我们还要添加一个飞机类（Plane），飞机类也具有Fly()的能力。若继承Bird做父类，则不合适。若不继承的话，飞机里面又定义一个Fly()方法，造成代码紊乱。<br>这个时候接口的作用就体现出来了，我们可以定义一个IFlyable接口，接口内定义Fly()方法。这样，对于喜鹊、老鹰和飞机，可以选择实现IFlyable接口，来实现飞行的功能。企鹅由于不能飞翔，因此可以不实现IFlyable接口。 </p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">public interface IFlyable</div><div class="line">&#123;</div><div class="line">    void Fly();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public abstract class Bird</div><div class="line">&#123;</div><div class="line">    public abstract void Eat();</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class Magpie : Bird, IFlyable</div><div class="line">&#123;</div><div class="line">    public override void Eat()</div><div class="line">    &#123;</div><div class="line">        Console.WriteLine("我吃虫子");</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void Fly()</div><div class="line">    &#123;</div><div class="line">        Console.WriteLine("我是喜鹊，我起飞啦");</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public class Eagle : Bird, IFlyable</div><div class="line">&#123;</div><div class="line">    public override void Eat()</div><div class="line">    &#123;</div><div class="line">        Console.WriteLine("我吃肉");</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public void Fly()</div><div class="line">    &#123;</div><div class="line">        Console.WriteLine("我是老鹰，我起飞啦");</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">public class Penguin : Bird</div><div class="line">&#123;</div><div class="line">    public override void Eat()</div><div class="line">    &#123;</div><div class="line">        Console.WriteLine("我吃鱼");</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class Program</div><div class="line">&#123;</div><div class="line">    static void Main(string[] args)</div><div class="line">    &#123;</div><div class="line">        IFlyable[] birds =  &#123;</div><div class="line">             new Magpie(),new Eagle()</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        foreach (var item in birds)</div><div class="line">        &#123;</div><div class="line">            item.Fly();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上述main方法体内，若在IFlyable[]内实例化Penguin会报错，因为企鹅没有实现IFlyable接口。<br>接口的使用充分表现了多态的魅力，很好的体现了开闭原则，若新增加蝴蝶类，则通过实现IFlyable接口即可实现其Fly()的功能，而无需对原来的类进行修改。</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/01/04/浅谈C#中多态的魅力（虚方法、抽象、接口实现）/" class="archive-article-date">
  	<time datetime="2017-01-04T08:37:32.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-01-04</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C#</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-C#接口和抽象类" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/04/C#接口和抽象类/">C#接口和抽象类</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="转载请尊重原作者iningwei成果，保留出处。https-iningwei-github-io"><a href="#转载请尊重原作者iningwei成果，保留出处。https-iningwei-github-io" class="headerlink" title="转载请尊重原作者iningwei成果，保留出处。https://iningwei.github.io"></a>转载请尊重原作者iningwei成果，保留出处。<a href="https://iningwei.github.io">https://iningwei.github.io</a></h2><h1 id="一-接口"><a href="#一-接口" class="headerlink" title="一,接口"></a>一,接口</h1><ul>
<li><p>接口是包含一组虚方法的抽象类型，其中每一种方法都有其名称、参数和返回值。 </p>
</li>
<li><p>接口方法不能包含任何实现，CLR中允许接口可以包含事件、属性、索引器、静态方法、静态字段、静态构造函数以及参数。但是C#中不能包含任何静态成员。</p>
</li>
<li><p>一个类可以实现多个接口，当一个类继承某个接口时，不仅要实现该接口定义的所有方法，还要实现该接口从其它接口中继承的所有方法。</p>
</li>
</ul>
<h1 id="二，抽象类"><a href="#二，抽象类" class="headerlink" title="二，抽象类"></a>二，抽象类</h1><ul>
<li><p>抽象类提供多个派生类共享基类的公共定义，它既可以提供抽象方法，也可以提供非抽象方法。</p>
</li>
<li><p>抽象类不能被实例化，必须通过继承由派生类实现其抽象方法，因此对抽象类不能使用new关键字，也不能被密封。如果派生类没有实现所有的抽象方法，则该派生类也必须声明为抽象类。</p>
</li>
</ul>
<h1 id="三，相同点和不同点"><a href="#三，相同点和不同点" class="headerlink" title="三，相同点和不同点"></a>三，相同点和不同点</h1><h2 id="3-1-相同点"><a href="#3-1-相同点" class="headerlink" title="3.1 相同点"></a>3.1 相同点</h2><ul>
<li>都不能被直接实例化，都可以通过继承实现其抽象方法。</li>
<li>都是面向抽象编程的技术基础。</li>
</ul>
<h2 id="3-2-不同点"><a href="#3-2-不同点" class="headerlink" title="3.2 不同点"></a>3.2 不同点</h2><ul>
<li>接口支持多继承；抽象类不能实现多继承。</li>
<li>接口只能定义抽象规则；抽象类既可以定义规则，还可以提供已实现的成员。</li>
<li>接口是一组行为规范；抽象类是一个不完全的类。</li>
<li>接口只包含方法、属性、索引器、事件的签名，不能定义字段和包含实现的方法；抽象类可以定义字段、属性、包含有实现的方法。</li>
<li>接口可以作用于值类型和引用类型；抽象类只能作用于引用类型。如：struct就可以继承接口，而不能继承类。</li>
</ul>
<h2 id="3-3-规则"><a href="#3-3-规则" class="headerlink" title="3.3 规则"></a>3.3 规则</h2><ul>
<li>抽象类主要用于关系密切的对象，而接口最适合为不相关的类提供通用功能。</li>
<li>接口着重于can-do关系类型，而抽象类侧重于is-a似的关系。简单说，一个类继承了某个抽象类表示它“是什么”，实现了某个接口表示它“有什么功能”或者“会做什么事”。比如：燕子（具体类）是鸟（抽象类），会飞（接口）。C#中不支持多继承，即燕子只能是鸟，不会是其他东西了；但可以有多个功能，做很多事，比如会飞（IFly），会吃（IEat）。</li>
<li>在接口中，所有的方法都默认为public。</li>
<li>“接口不变”是应该考虑的重要因素，所以在由接口增加扩展时，应该增加新的接口，而不能更改现有接口。</li>
<li>尽量将接口设计成功能单一的功能块，以.NET Framework为例，IDisposable、IComparable、IEnumerable等都只包含一个公共方法。</li>
<li>接口名称前面的大写字母“I”是一个约定。</li>
<li>如果预计会出现版本问题，可以创建“抽象类”。例如，创建了Dog、Chicken和Duck,那么应该考虑抽象出Animal来应对以后可能出现风马牛的事情。</li>
<li>从抽象类派生的非抽象类必须包括继承的所有抽象方法的实现。</li>
<li>抽象类不能被实例化，因此其不能使用new关键字，也不能被密封。</li>
</ul>
<h2 id="3-4-MSDN的建议"><a href="#3-4-MSDN的建议" class="headerlink" title="3.4 MSDN的建议"></a>3.4 MSDN的建议</h2><ul>
<li>如果预计要创建组件的多个版本，则创建抽象类。抽象类提供简单易行的方法来控制组件版本。通过更新基类，所有继承类都随更改自动更新。另一方面，接口一旦创建就不能更改。如果需要接口的新版本，必须创建一个全新的接口。</li>
<li>如果创建的功能将在大范围的全异对象间使用，则使用接口。抽象类应主要用于关系密切的对象，而接口最适合为不相关的类提供通用功能。</li>
<li>如果要设计小而简练的功能块，则使用接口。如果要设计大的功能单元，则使用抽象类。</li>
<li>如果要在组件的所有实现间提供通用的已实现功能，则使用抽象类。抽象类允许部分实现类，而接口不包含任何成员的实现。</li>
</ul>
<h1 id="四，经典示例"><a href="#四，经典示例" class="headerlink" title="四，经典示例"></a>四，经典示例</h1><p>.NET Framework中，集合类使用了基于接口的设计，请关注System.Collections中关于接口的设计实现；数据流相关的类使用了基于抽象类的设计，请关注System.IO.Stream类的抽象类设计机制。</p>
<h1 id="五，参考文档"><a href="#五，参考文档" class="headerlink" title="五，参考文档"></a>五，参考文档</h1><p><a href="http://www.cnblogs.com/ronli/archive/2011/10/26/2224654.html" target="_blank" rel="external">http://www.cnblogs.com/ronli/archive/2011/10/26/2224654.html</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/01/04/C#接口和抽象类/" class="archive-article-date">
  	<time datetime="2017-01-04T06:49:50.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-01-04</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C#</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-C#中重写、重载、多态的区别" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/04/C#中重写、重载、多态的区别/">C#中重写、重载、多态的区别</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="转载请尊重原作者iningwei成果，保留出处。https-iningwei-github-io"><a href="#转载请尊重原作者iningwei成果，保留出处。https-iningwei-github-io" class="headerlink" title="转载请尊重原作者iningwei成果，保留出处。https://iningwei.github.io"></a>转载请尊重原作者iningwei成果，保留出处。<a href="https://iningwei.github.io">https://iningwei.github.io</a></h2><h1 id="一，重写"><a href="#一，重写" class="headerlink" title="一，重写"></a>一，重写</h1><p>是指派生类重写基类的方法，在基类中的方法必须有修饰符virtual,而在子类的方法中必须使用override关键字。 </p>
<h1 id="二，重载"><a href="#二，重载" class="headerlink" title="二，重载"></a>二，重载</h1><p>同名方法的情况下，参数列表的不同构成了对方法的重载。方法的返回类型可以不同。</p>
<h1 id="三，多态"><a href="#三，多态" class="headerlink" title="三，多态"></a>三，多态</h1><p>多态主要体现在类的继承上，子类继承父类的时候，可能出现同名但方法定义不同的情况，子类会将原方法覆盖，实现自己的要求。<br>需要注意的是：<br>可以在子类中被重写的方法一定要被标记成virtual(虚拟), abstract（抽象), override(重写）。标记为virtual 和abstract的函数就是为了重写而创建的，标记为override的函数本身是由前两种函数重写而来的，所以它也可以被继续重写。</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2017/01/04/C#中重写、重载、多态的区别/" class="archive-article-date">
  	<time datetime="2017-01-04T06:24:12.000Z" itemprop="datePublished"><i class="icon-clock"></i>2017-01-04</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C#</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="posts-Unity3D 图片格式和出包大小之间的关系" class="article article-type-posts" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/10/07/Unity3D 图片格式和出包大小之间的关系/">Unity3D 图片格式和出包大小之间的关系</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文以PC平台说明。所用素材为:<a href="http://pan.baidu.com/s/1sOuK2/" target="_blank" rel="external">http://pan.baidu.com/s/1sOuK2/</a></p>
<h1 id="情况一"><a href="#情况一" class="headerlink" title="情况一:"></a>情况一:</h1><p>一张jpg图片分辨率1024*768，在PC上占用的空间为762KB。<br>复制50张。  </p>
<h2 id="1：放到StreamingAssets目录下"><a href="#1：放到StreamingAssets目录下" class="headerlink" title="1：放到StreamingAssets目录下"></a>1：放到StreamingAssets目录下</h2><p>打包后，50张图在生成的包的StreamingAssets目录下，且每个图片的空间为762KB。<br>StreamingAssets目录大小为37.2MB。即没有压缩、没有二进制打包。StreamingAssets目录下的保持原样。在Unity中改变图片的纹理压缩格式，对打出的包的大小没有影响，即只和原始格式有关。</p>
<h2 id="2：放到Resources目录下"><a href="#2：放到Resources目录下" class="headerlink" title="2：放到Resources目录下"></a>2：放到Resources目录下</h2><p>图片的纹理格式为RGB ETC1 4bit时，每个图占用内存384KB（逐像素算，不同于外存中图片大小的算法）。384*50=19200<br>再看最终resources.assets文件大小为19208KB（18.7MB）。即约等于每个图片的内存大小之和。</p>
<h1 id="情况二"><a href="#情况二" class="headerlink" title="情况二:"></a>情况二:</h1><p>对该jpg图片进行压缩。<br>本人使用Sage Thumbs的右键快捷方式：转换为jpg，把50个图片转换了一下（保持尺寸不变），每个图片在PC的存储空间从762KB变成184KB。<br>再放到StreamingAssets下打包,StreamingAssets包的大小变为8.99MB。<br>放到resources目录下打包，依旧使用RGB ETC1 4bit。最终结果依旧为19208KB（18.7MB）。  </p>
<p>综上：图片若是放在StreamingAssets目录下，尽量减少图片的占用空间，从而减少包的尺寸。<br>Resources目录下打包，图片最终占用空间和其最终运行时占用的内存一致，即跟其纹理压缩格式有关。另外Resources目录打包后是以二进制格式保存的，比较安全。</p>
<h1 id="情况三"><a href="#情况三" class="headerlink" title="情况三:"></a>情况三:</h1><p>打assetbundle<br>回到每张图外存762KB的情况，使用RGB ETC1 4bit （每个图384KB）的纹理压缩格式。对每个图打成assetbundle，每个assetbundle大小为200KB。<br>再使用RGB 16bit（每个图占用1.5MB）的纹理压缩格式，每个图的assetbundle大小为470KB。<br>再使用RGB 16bit的纹理压缩格式，再把图片外存改成184KB（按照上述情况二所述），打出的assetbundle大小为582KB。</p>
<p>综上：可见assetbundle大小也和纹理压缩格式有关，纹理压缩格式占用空间越大，bundle也越大。相对来说assetbundle在纹理压缩的基础上还进一步压缩了，从而减少大小。<br>另外和原始外存压缩格式也有关，具体关系本人也没有深究。<br>由于assetbundle一般不放到Resources目录下，所以这里不讨论放到Resources目录下的情况。<br>（实际上我也测试了一下，把assetbundle单独放到Resources目录下，打出的包没有resources.assets这个文件）</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/10/07/Unity3D 图片格式和出包大小之间的关系/" class="archive-article-date">
  	<time datetime="2016-10-07T12:31:06.183Z" itemprop="datePublished"><i class="icon-clock"></i>2016-10-07</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-MemoryPool" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/06/MemoryPool/">MemoryPool</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://pastebin.com/R8afbmVm" target="_blank" rel="external">http://pastebin.com/R8afbmVm</a></p>
<pre><code>// MIT license - TL;DR - Do whatever you want with it, I&apos;m not liable for what you do with it!
#define FAIL_FAST
using UnityEngine;
using System.Collections;
using System.Collections.Generic;

/// &lt;summary&gt;
/// &lt;para&gt;Used for memory recycling of reference types, like GameObjects&lt;/para&gt;
/// &lt;para&gt;Example usage:&lt;/para&gt;
/// &lt;para&gt;MemoryPool&lt;GameObject&gt; memPool = new MemoryPool&lt;GameObject&gt;(); // construction&lt;/para&gt;
/// &lt;para&gt;memPool.Setup(
///        ()    =&gt; Instantiate(prefab),
///        (obj) =&gt; { obj.SetActive(true);  },
///        (obj) =&gt; { obj.SetActive(false); },
///        (obj) =&gt; { Object.Destroy(obj);  }
/// );&lt;/para&gt;
/// &lt;para&gt;GameObject gobj = memPool.Alloc();  // allocate object in pool&lt;/para&gt;
/// &lt;para&gt;memPool.Free(gobj); // deallocate object in pool&lt;/para&gt;
/// &lt;para&gt;MemoryPoolItem.Destroy(gobj); // deallocate object in pool OR Object.Destroy non-MemoryPool object (for GameObjects only)&lt;/para&gt;
/// &lt;/summary&gt;
public class MemoryPool&lt;T&gt; where T : class
{
private List&lt;T&gt; allObjects = null;
private int freeObjectCount = 0;

public delegate T DelegateBeginLife();
public delegate void DelegateCommission(T obj);
public delegate void DelegateDecommission(T obj);
public delegate void DelegateEndLife(T obj);

public DelegateBeginLife birth;
public DelegateEndLife death;
public DelegateCommission commission;
public DelegateDecommission decommission;

/// &lt;summary&gt;
/// Example usage:
/// &lt;para&gt;memPool.Setup(
///        ()    =&gt; Instantiate(prefab),
///        (obj) =&gt; obj.SetActive(true),
///        (obj) =&gt; obj.SetActive(false),
///        (obj) =&gt; Object.Destroy(obj)
/// );&lt;/para&gt;
/// &lt;/summary&gt;
/// &lt;param name=&quot;create&quot;&gt;callback function or delegate used to create a new object of type T&lt;/param&gt;
/// &lt;param name=&quot;activate&quot;&gt;callback function or delegate used to activate an object of type T&lt;/param&gt;
/// &lt;param name=&quot;deactivate&quot;&gt;callback function or delegate used to de-activate an object of type T&lt;/param&gt;
/// &lt;param name=&quot;destroy&quot;&gt;callback function or delegate used to destroy an object of type T&lt;/param&gt;
public void Setup(DelegateBeginLife create, DelegateCommission activate, DelegateDecommission deactivate, DelegateEndLife destroy)
{
    birth = create; commission = activate; decommission = deactivate; death = destroy;
}

/// &lt;summary&gt;Constructs and calls &lt;see cref=&quot;Setup&quot;/&gt;&lt;/summary&gt;
public MemoryPool(DelegateBeginLife create, DelegateCommission activate, DelegateDecommission deactivate, DelegateEndLife destroy)
{
    Setup(create, activate, deactivate, destroy);
}

/// &lt;summary&gt; Be sure to call &lt;see cref=&quot;Setup&quot;/&gt;!&lt;/summary&gt;
public MemoryPool() { }

/// &lt;summary&gt;Returns an object from the memory pool, which may have just been created&lt;/summary&gt;
public T Alloc()
{
    T freeObject = null;
    if (freeObjectCount == 0)
    {
        #if FAIL_FAST
        if (birth == null) { throw new System.Exception(&quot;Call .Setup(), and provide a create method!&quot;); }
        #endif
        if (allObjects == null) { allObjects = new List&lt;T&gt;(); }
        freeObject = birth();
        allObjects.Add(freeObject);
        if (typeof(T) == typeof(GameObject))
        {
            GameObject go = freeObject as GameObject;
            go.AddComponent&lt;MemoryPoolItem&gt;().SetPool(this as MemoryPool&lt;GameObject&gt;);
        }
    }
    else
    {
        freeObject = allObjects[allObjects.Count - freeObjectCount];
        freeObjectCount--;
    }
    if (commission != null) { commission(freeObject); }
    return freeObject;
}

/// &lt;summary&gt;Which object to mark as free in the memory pool&lt;/summary&gt;
public void Free(T obj)
{
    int indexOfObject = allObjects.IndexOf(obj);
    #if FAIL_FAST
    if (indexOfObject &lt; 0) { throw new System.Exception(&quot;woah, this isn&apos;t one of mine...&quot;); }
    if (indexOfObject &gt;= (allObjects.Count - freeObjectCount)) { throw new System.Exception(&quot;hey, you&apos;re freeing this twice...&quot;); }
    #endif
    freeObjectCount++;
    int beginningOfFreeList = allObjects.Count - freeObjectCount;
    allObjects[indexOfObject] = allObjects[beginningOfFreeList];
    allObjects[beginningOfFreeList] = obj;
    if (decommission != null) { decommission(obj); }
}

/// &lt;summary&gt;performs the given delegate on each object in the memory pool&lt;/summary&gt;
public void ForEach(DelegateCommission action)
{
    for (int i = 0; i &lt; allObjects.Count; ++i) { action(allObjects[i]); }
}

/// &lt;summary&gt;Destroys all objects in the pool, after deactivating each one.&lt;/summary&gt;
public void DeallocateAll()
{
    ForEach((item) =&gt; decommission(item));
    if (typeof(T) == typeof(GameObject))
    {
        ForEach((item) =&gt;
        {
            GameObject go = item as GameObject;
            Object.DestroyImmediate(go.GetComponent&lt;MemoryPoolItem&gt;());
        });
    }
    if (death != null) { ForEach((item) =&gt; death(item)); }
    allObjects.Clear();
}
}

public class MemoryPoolItem : MonoBehaviour
{
private MemoryPool&lt;GameObject&gt; gameObjectPool;
public MemoryPoolItem SetPool(MemoryPool&lt;GameObject&gt; pool) { gameObjectPool = pool; return this; }
static private bool shuttingDown = false;
static public void SetShutdown(bool sceneIsEnding) { shuttingDown = sceneIsEnding; }
#if FAIL_FAST
void OnApplicationQuit() { SetShutdown(true); }
void Start() { SetShutdown(false); }
void OnDestroy()
{
    if (!shuttingDown) throw new System.Exception(&quot;Instead of Object.Destroy(&quot; + gameObject + &quot;), call MemoryPoolItem.Destroy(&quot; + gameObject + &quot;)\n&quot;+ &quot;When changing levels, call MemoryPoolItem.SetShutdown(true) first&quot;);
}
#endif
public void FreeSelf() { gameObjectPool.Free(gameObject); }
/// &lt;summary&gt;If the given GameObject belongs to a memory pool, mark it as free in that pool. Otherwise, Object.Destroy()&lt;/summary&gt;
static public void Destroy(GameObject go)
{
    MemoryPoolItem i = go.GetComponent&lt;MemoryPoolItem&gt;();
    if (i != null) { i.FreeSelf(); }
    else { Object.Destroy(go); }
}
}
</code></pre>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/03/06/MemoryPool/" class="archive-article-date">
  	<time datetime="2016-03-06T14:47:39.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-03-06</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Unity3D中的一些技巧总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/06/Unity3D中的一些技巧总结/">Unity3D中的一些技巧总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>以下tip来源于网络（unity wiki、unity fb、unity Twitter等）  </p>
<h1 id="1："><a href="#1：" class="headerlink" title="1："></a>1：</h1><p>When you’re using Debug.Log or related methods, provide the instance of the script so you can click the log output and have the relevant object selected in editor! Debug.Log(“Test”, this);  </p>
<h1 id="2："><a href="#2：" class="headerlink" title="2："></a>2：</h1><p>To remember which color means what on an axis in Unity, just remember the mnemonic: RGB = XYZ.</p>
<h1 id="3：Draw-editor-gui’s-only-in-active-scene-view"><a href="#3：Draw-editor-gui’s-only-in-active-scene-view" class="headerlink" title="3：Draw editor gui’s only in active scene view"></a>3：Draw editor gui’s only in active scene view</h1><p>If you are creating custom editors for unity but only want the gui for that editor to be drawn in the currently active scene view try this …  </p>
<pre><code>if (SceneView.mouseOverWindow.GetInstanceID() == SceneView.currentDrawingSceneView.GetInstanceID())
{
    this.DrawGUI(SceneView.currentDrawingSceneView);
}
</code></pre><h1 id="4：Execute-menu-items-from-editor-script"><a href="#4：Execute-menu-items-from-editor-script" class="headerlink" title="4：Execute menu items from editor script"></a>4：Execute menu items from editor script</h1><p>If you want to take advantage of functionality that is provided by menu commands you can useEditorApplication.ExecuteMenuItem in your editor scripts to execute them.</p>
<h1 id="5：Screen-Resolution"><a href="#5：Screen-Resolution" class="headerlink" title="5：Screen Resolution"></a>5：Screen Resolution</h1><p>If you need to set the screen resolution of your game via scripting check out Screen.SetResolution.</p>
<h1 id="6：Collider-manipulation"><a href="#6：Collider-manipulation" class="headerlink" title="6：Collider manipulation"></a>6：Collider manipulation</h1><p>Did you know that you can manipulate a game objects collider in the scene view by holding down the ‘Shift’ key. Holding shift will display the colliders control dots. Just drag the dots to adjust the collider!</p>
<h1 id="7：Running-Editor-Script-Code-on-Launch"><a href="#7：Running-Editor-Script-Code-on-Launch" class="headerlink" title="7：Running Editor Script Code on Launch"></a>7：Running Editor Script Code on Launch</h1><p>If you need to run some script code as soon as the editor has launched you can use the InitializeOnLoad attribute.</p>
<h1 id="8：各平台下的log文件"><a href="#8：各平台下的log文件" class="headerlink" title="8：各平台下的log文件"></a>8：各平台下的log文件</h1><p><a href="http://docs.unity3d.com/Manual/LogFiles.html" target="_blank" rel="external">http://docs.unity3d.com/Manual/LogFiles.html</a></p>
<h1 id="9：unity的命令行参数"><a href="#9：unity的命令行参数" class="headerlink" title="9：unity的命令行参数"></a>9：unity的命令行参数</h1><p><a href="http://docs.unity3d.com/Manual/CommandLineArguments.html" target="_blank" rel="external">http://docs.unity3d.com/Manual/CommandLineArguments.html</a></p>
<h1 id="11：Can-you-hear-me-now"><a href="#11：Can-you-hear-me-now" class="headerlink" title="11：Can you hear me now?"></a>11：Can you hear me now?</h1><p>Unity provides access to the users microphone via the Microphone class.<br><a href="http://docs.unity3d.com/ScriptReference/Microphone.html" target="_blank" rel="external">http://docs.unity3d.com/ScriptReference/Microphone.html</a></p>
<h1 id="12：Location-awareness"><a href="#12：Location-awareness" class="headerlink" title="12：Location awareness"></a>12：Location awareness</h1><p>Unity provides support for location awareness such as longitude, latitude, and altitude in the LocationService class.<br><a href="http://docs.unity3d.com/ScriptReference/LocationService.html" target="_blank" rel="external">http://docs.unity3d.com/ScriptReference/LocationService.html</a></p>
<h1 id="13：Social-Platforms"><a href="#13：Social-Platforms" class="headerlink" title="13：Social Platforms"></a>13：Social Platforms</h1><p>Unity provides built in support for various social platforms including support for custom implementations through the Social class.<br><a href="http://docs.unity3d.com/ScriptReference/Social.html" target="_blank" rel="external">http://docs.unity3d.com/ScriptReference/Social.html</a></p>
<h1 id="14：Gyroscopes"><a href="#14：Gyroscopes" class="headerlink" title="14：Gyroscopes"></a>14：Gyroscopes</h1><p>If the device supports it you can use the Gyroscope class to get gyroscopic information about the orientation and acceleration of the device.<br><a href="http://docs.unity3d.com/ScriptReference/Gyroscope.html" target="_blank" rel="external">http://docs.unity3d.com/ScriptReference/Gyroscope.html</a></p>
<h1 id="15-EditorApplication"><a href="#15-EditorApplication" class="headerlink" title="15:EditorApplication"></a>15:EditorApplication</h1><p><a href="http://docs.unity3d.com/ScriptReference/EditorApplication.html" target="_blank" rel="external">http://docs.unity3d.com/ScriptReference/EditorApplication.html</a><br>场景的保存、新建、暂停等等用script模拟Editor相关操作</p>
<h1 id="16-MeshUtility-Optimize"><a href="#16-MeshUtility-Optimize" class="headerlink" title="16:MeshUtility.Optimize"></a>16:MeshUtility.Optimize</h1><p>程序生成的mesh可以用这个做优化</p>
<p><a href="http://docs.unity3d.com/ScriptReference/MeshUtility.Optimize.html" target="_blank" rel="external">http://docs.unity3d.com/ScriptReference/MeshUtility.Optimize.html</a></p>
<h1 id="17-UI渐变效果"><a href="#17-UI渐变效果" class="headerlink" title="17:UI渐变效果"></a>17:UI渐变效果</h1><p><a href="http://pastebin.com/dJabCfWn" target="_blank" rel="external">http://pastebin.com/dJabCfWn</a></p>
<pre><code>using UnityEngine;
using System.Collections;
using System.Collections.Generic;
using UnityEngine.UI;

[AddComponentMenu(&quot;UI/Effects/Gradient&quot;)]
public class Gradient : BaseVertexEffect {
[SerializeField]
private Color32 topColor = Color.white;
[SerializeField]
private Color32 bottomColor = Color.black;

public override void ModifyVertices(List&lt;UIVertex&gt; vertexList) {
    if (!IsActive()) {
        return;
    }

    int count = vertexList.Count;
    float bottomY = vertexList[0].position.y;
    float topY = vertexList[0].position.y;

    for (int i = 1; i &lt; count; i++) {
        float y = vertexList[i].position.y;
        if (y &gt; topY) {
            topY = y;
        }
        else if (y &lt; bottomY) {
            bottomY = y;
        }
    }

    float uiElementHeight = topY - bottomY;

    for (int i = 0; i &lt; count; i++) {
        UIVertex uiVertex = vertexList[i];
        uiVertex.color = Color32.Lerp(bottomColor, topColor, (uiVertex.position.y - bottomY) / uiElementHeight);
        vertexList[i] = uiVertex;
    }
}
}
</code></pre><h1 id="18-AABB碰撞检测"><a href="#18-AABB碰撞检测" class="headerlink" title="18:AABB碰撞检测"></a>18:AABB碰撞检测</h1><p><a href="http://pastebin.com/BCEgZxSf" target="_blank" rel="external">http://pastebin.com/BCEgZxSf</a></p>
<pre><code>using UnityEngine;
using System.Collections;

public static class Aabb

{

public static bool Colliding( GameObject a, GameObject b )
{
    Rect aBox = a.BoxToRect();
    Rect bBox = b.BoxToRect();

    // Find out if these guys intersect
    return Intersect ( aBox, bBox );
}

// This checks the intersection between two rectangles.
public static bool Intersect( Rect a, Rect b ) 
{
    // Basic AABB collision detection. All of these must be true for there to be a collision.
    bool comp1 = a.yMin &gt; b.yMax;
    bool comp2 = a.yMax &lt; b.yMin;
    bool comp3 = a.xMin &lt; b.xMax;
    bool comp4 = a.xMax &gt; b.xMin;

    // This will only return true if all are true.
    return comp1 &amp;&amp; comp2 &amp;&amp; comp3 &amp;&amp; comp4;
}

// This converts a BoxCollider2D to a rectangle for use in determining an intersection
private static Rect BoxToRect ( this GameObject a )
{
    // Finding the BoxCollider2D for the GameObject.
    BoxCollider2D aCollider = a.GetComponent&lt;BoxCollider2D&gt; ();

    // Grabbing the GameObject position, converting it to Vector2.
    Vector2 aPos = a.transform.position.V2();

    // Now that we have the object&apos;s worldspace location, we offset that to the BoxCollider&apos;s center
    aPos += aCollider.center;
    // From the center, we find the top/left corner by cutting the total height/width in half and 
    // offset by that much
    aPos.x -= aCollider.size.x/2;
    aPos.y += aCollider.size.y/2;

    // Create a rectangle based on the top/left corner, and extending the rectangle 
    // to the width/height
    return new Rect ( aPos.x, aPos.y, aCollider.size.x, -aCollider.size.y );
}

// Converts a Vector 3 to Vector 2
private static Vector2 V2 ( this Vector3 v ) 
{
    // Converts the Vector3 to a Vector2.
    return new Vector2 (v.x, v.y);
}

}
</code></pre><h1 id="19：Weapon-Sway-Unity3D"><a href="#19：Weapon-Sway-Unity3D" class="headerlink" title="19：Weapon Sway Unity3D"></a>19：Weapon Sway Unity3D</h1><p><a href="http://pastebin.com/p5XagGuy" target="_blank" rel="external">http://pastebin.com/p5XagGuy</a></p>
<pre><code>//============================================
// ATTACH THIS TO WEAPON
//
// ATTACH WEAPON TO PLAYER GAMEOBJECT
//============================================

using UnityEngine;
using System.Collections;

public class WeaponSwayScript : MonoBehaviour {
public float mouseSensitivity = 10f;
public float maxMoveAmount = 0.5f;
public float smoothSpeed = 3f;

private Vector3 startPos;

private float factorX;
private float factorY;

public bool bRotate;
public float smoothRotationSpeed = 2f;
public float rotateAmount = 45f;

//============================================
// FUNCTIONS
//============================================

void Start()
{
    startPos = transform.localPosition;
}

void Update()
{
    // STORE MOUSE MOVEMENT AMOUNTS, SMOOTH WITH LERP
    factorX = Mathf.Lerp(factorX, -Input.GetAxis(&quot;Mouse X&quot;) * mouseSensitivity, Time.deltaTime * 10f);
    factorY = Mathf.Lerp(factorY, -Input.GetAxis(&quot;Mouse Y&quot;) * mouseSensitivity, Time.deltaTime * 10f);

    // CLAMP LIMITS
    if (factorX &gt; maxMoveAmount)
        factorX = maxMoveAmount;

    if (factorX &lt; -maxMoveAmount)
        factorX = -maxMoveAmount;

    if (factorY &gt; maxMoveAmount)
        factorY = maxMoveAmount;

    if (factorY &lt; -maxMoveAmount)
        factorY = -maxMoveAmount;

    // SET TARGET POSITION (START POSITION + MOUSE MOVEMENT)
    Vector3 targetPos = new Vector3(startPos.x + factorX, startPos.y + factorY, startPos.z);

    // APPLY POSITION TO WEAPON, SMOOTH WITH LERP
    transform.localPosition = Vector3.Lerp(transform.localPosition, targetPos, smoothSpeed * Time.deltaTime);

    // ROTATION
    if (bRotate)
    {
        float tiltAroundZ = Input.GetAxis(&quot;Mouse X&quot;) * rotateAmount;
        float tiltAroundX = Input.GetAxis(&quot;Mouse Y&quot;) * rotateAmount;
        Vector3 target = new Vector3(tiltAroundX, 0f, tiltAroundZ);
        transform.localRotation = Quaternion.Slerp(transform.localRotation, Quaternion.Euler(target), Time.deltaTime * smoothRotationSpeed);
    }
}
}
</code></pre>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/03/06/Unity3D中的一些技巧总结/" class="archive-article-date">
  	<time datetime="2016-03-06T14:19:40.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-03-06</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/奇淫技巧/">奇淫技巧</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-DES加密" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/06/DES加密/">DES加密</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>具体请百度，下面为封装好的类（代码细节请参考msdn）:  </p>
<pre><code>/// &lt;summary&gt;
///DES加密算法
/// &lt;/summary&gt;
public class DES
{
public DES()
{
    //
    //TODO: 在此处添加构造函数逻辑
    //
}

/// &lt;summary&gt;
/// 对字符进行加密
/// &lt;/summary&gt;
/// &lt;param name=&quot;pToEncrypt&quot;&gt;输入字符串&lt;/param&gt;
/// &lt;param name=&quot;sKey&quot;&gt;密钥，要求为8个字节共64位&lt;/param&gt;
/// &lt;returns&gt;返回加密结果&lt;/returns&gt;
public static string Encrypt(string pToEncrypt, string sKey)
{
    DESCryptoServiceProvider des = new DESCryptoServiceProvider();

    byte[] inputByteArray = Encoding.Default.GetBytes(pToEncrypt);
    des.Key = ASCIIEncoding.ASCII.GetBytes(sKey);
    des.IV = ASCIIEncoding.ASCII.GetBytes(sKey);
    MemoryStream ms = new MemoryStream();
    CryptoStream cs = new CryptoStream(ms, des.CreateEncryptor(), CryptoStreamMode.Write);
    cs.Write(inputByteArray, 0, inputByteArray.Length);
    cs.FlushFinalBlock();
    StringBuilder ret = new StringBuilder();
    foreach (byte b in ms.ToArray())
    {
        ret.AppendFormat(&quot;{0:X2} &quot;, b);
    }
    ret.ToString();
    return ret.ToString();
}

/// &lt;summary&gt;
/// 对已加密字符密文解密
/// &lt;/summary&gt;
/// &lt;param name=&quot;pToDecrypt&quot;&gt;已加密字符&lt;/param&gt;
/// &lt;param name=&quot;sKey&quot;&gt;密钥，要求为8个字节共64位&lt;/param&gt;
/// &lt;returns&gt;解密结果&lt;/returns&gt;
public static string Decrypt(string pToDecrypt, string sKey)
{
    pToDecrypt = pToDecrypt.Replace(&quot; &quot;, &quot;&quot;);//加密后的密文两位一组，组与组之间以空格隔开
                                             //这里要先去除所有空格

    DESCryptoServiceProvider des = new DESCryptoServiceProvider();
    byte[] inputByteArray = new byte[pToDecrypt.Length / 2];
    for (int x = 0; x &lt; pToDecrypt.Length / 2; x++)
    {
        int i = (Convert.ToInt32(pToDecrypt.Substring(x * 2, 2), 16));
        inputByteArray[x] = (byte)i;
    }
    des.Key = ASCIIEncoding.ASCII.GetBytes(sKey);
    des.IV = ASCIIEncoding.ASCII.GetBytes(sKey);
    MemoryStream ms = new MemoryStream();
    CryptoStream cs = new CryptoStream(ms, des.CreateDecryptor(), CryptoStreamMode.Write);
    cs.Write(inputByteArray, 0, inputByteArray.Length);
    cs.FlushFinalBlock();
    StringBuilder ret = new StringBuilder();
    return System.Text.Encoding.Default.GetString(ms.ToArray());
}

/// &lt;summary&gt;
/// 加密文件
/// &lt;/summary&gt;
/// &lt;param name=&quot;sInputFile&quot;&gt;源文件&lt;/param&gt;
/// &lt;param name=&quot;sOutputFile&quot;&gt;加密过后的文件&lt;/param&gt;
/// &lt;param name=&quot;sKey&quot;&gt;密钥，要求为8个字节共64位&lt;/param&gt;
/// &lt;param name=&quot;sMsg&quot;&gt;返回信息&lt;/param&gt;
/// &lt;returns&gt;是否成功&lt;/returns&gt;
public static bool EncryptFile(string sInputFilename, string sOutputFilename, string sKey, out string sMsg)
{
    bool IsSuccess = true;
    FileStream fsInput = null;
    FileStream fsEncrypted = null;
    CryptoStream cryptostream = null;
    try
    {
        fsInput = new FileStream(sInputFilename, FileMode.Open, FileAccess.Read);
        fsEncrypted = new FileStream(sOutputFilename, FileMode.Create,FileAccess.Write);
        DESCryptoServiceProvider des = new DESCryptoServiceProvider();
        des.Key = ASCIIEncoding.ASCII.GetBytes(sKey);
        des.IV = ASCIIEncoding.ASCII.GetBytes(sKey);
        ICryptoTransform desencrypt = des.CreateEncryptor();
        cryptostream = new CryptoStream(fsEncrypted,
                                        desencrypt,
                                        CryptoStreamMode.Write);
        byte[] bytearrayinput = new byte[fsInput.Length];
        fsInput.Read(bytearrayinput, 0, bytearrayinput.Length);
        cryptostream.Write(bytearrayinput, 0, bytearrayinput.Length);
        cryptostream.Close();
        fsInput.Close();
        fsEncrypted.Close();
        sMsg = &quot;成功&quot;;
        return true;
    }
    catch (Exception ex)
    {
        sMsg = ex.Message;
        IsSuccess = true;
    }
    finally
    {
        try
        {
            if (cryptostream != null) cryptostream.Close();
            if (fsInput != null) fsInput.Close();
            if (fsEncrypted != null) fsEncrypted.Close();
        }
        catch
        {
        }
    }
    return IsSuccess;
}

/// &lt;summary&gt;
/// 解密文件
/// &lt;/summary&gt;
/// &lt;param name=&quot;sInputFilename&quot;&gt;输入文件（已加密文件）路径&lt;/param&gt;
/// &lt;param name=&quot;sOutputFilename&quot;&gt;解密后文件路径&lt;/param&gt;
/// &lt;param name=&quot;sKey&quot;&gt;密钥，要求为8个字节共64位&lt;/param&gt;
/// &lt;param name=&quot;sMsg&quot;&gt;返回信息&lt;/param&gt;
/// &lt;returns&gt;是否成功&lt;/returns&gt;
public static bool DecryptFile(string sInputFilename, string sOutputFilename, string sKey, out string sMsg)
{
    bool IsSuccess = true;
    FileStream fsInput = null;
    FileStream fsDecrypted = null;
    CryptoStream cryptostream = null;
    try
    {
        fsInput = new FileStream(sInputFilename, FileMode.Open, FileAccess.Read);
        fsDecrypted = new FileStream(sOutputFilename, FileMode.Create, FileAccess.Write);
        DESCryptoServiceProvider des = new DESCryptoServiceProvider();
        des.Key = ASCIIEncoding.ASCII.GetBytes(sKey);
        des.IV = ASCIIEncoding.ASCII.GetBytes(sKey);
        ICryptoTransform desdecrypt = des.CreateDecryptor();
        cryptostream = new CryptoStream(fsDecrypted,
                                        desdecrypt,
                                        CryptoStreamMode.Write);
        byte[] bytearrayinput = new byte[fsInput.Length];
        fsInput.Read(bytearrayinput, 0, bytearrayinput.Length);
        cryptostream.Write(bytearrayinput, 0, bytearrayinput.Length);
        cryptostream.Close();
        fsInput.Close();
        fsDecrypted.Close();
        sMsg = &quot;成功&quot;;
        return true;
    }
    catch (Exception ex)
    {
        sMsg = ex.Message;
        IsSuccess = true;
    }
    finally
    {
        try
        {
            if (cryptostream != null) cryptostream.Close();
            if (fsInput != null) fsInput.Close();
            if (fsDecrypted != null) fsDecrypted.Close();
        }
        catch
        {
        }
    }
    return IsSuccess;
}
}
</code></pre>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/03/06/DES加密/" class="archive-article-date">
  	<time datetime="2016-03-06T14:02:37.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-03-06</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C#</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Unity3D交互相关总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/06/Unity3D交互相关总结/">Unity3D交互相关总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Input.MouseButtonDown触屏、电脑通用，只要有按下操作，不需要collider</p>
<p>NGUI 中带collider的UI是可以接受到射线检测的，不过需要注意的是</p>
<pre><code>void Update()
{
    if (Input.GetMouseButtonDown(0))//
    {
        Ray ray = camera.ScreenPointToRay(Input.mousePosition);
        RaycastHit raycastHit;
        if (Physics.Raycast(ray, out raycastHit))
        {
            Debug.LogError(raycastHit.collider.name);


        }
    }
}
</code></pre><p>这里相机需要用UI相机，而不是Camera.main</p>
<p>带Collider的UI无法响应Unity自带的OnMouseDown、OnMOuseUp、OnMouseDrag事件。<br>经测试用主相机渲染的带collider的UI也无法相应上述事件</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/03/06/Unity3D交互相关总结/" class="archive-article-date">
  	<time datetime="2016-03-06T13:48:48.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-03-06</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 iningwei
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/NET/" style="font-size: 10px;">.NET</a> <a href="/tags/3DSMax/" style="font-size: 10px;">3DSMax</a> <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/C/" style="font-size: 16px;">C#</a> <a href="/tags/NShader/" style="font-size: 10px;">NShader</a> <a href="/tags/Shader/" style="font-size: 12px;">Shader</a> <a href="/tags/Unity3D/" style="font-size: 20px;">Unity3D</a> <a href="/tags/Visual-Studio/" style="font-size: 10px;">Visual Studio</a> <a href="/tags/cg/" style="font-size: 18px;">cg</a> <a href="/tags/lua/" style="font-size: 10px;">lua</a> <a href="/tags/ulua/" style="font-size: 10px;">ulua</a> <a href="/tags/反射/" style="font-size: 10px;">反射</a> <a href="/tags/安卓/" style="font-size: 10px;">安卓</a> <a href="/tags/小众软件/" style="font-size: 10px;">小众软件</a> <a href="/tags/工具/" style="font-size: 10px;">工具</a> <a href="/tags/插件/" style="font-size: 10px;">插件</a> <a href="/tags/操作系统使用/" style="font-size: 10px;">操作系统使用</a> <a href="/tags/数据结构与算法/" style="font-size: 10px;">数据结构与算法</a> <a href="/tags/沙里淘金/" style="font-size: 10px;">沙里淘金</a> <a href="/tags/热更新/" style="font-size: 12px;">热更新</a> <a href="/tags/编辑器扩展/" style="font-size: 10px;">编辑器扩展</a> <a href="/tags/视频/" style="font-size: 10px;">视频</a> <a href="/tags/软件安装/" style="font-size: 14px;">软件安装</a>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>