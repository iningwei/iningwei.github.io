<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>iningwei的私家宅院</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="测试description">
<meta property="og:type" content="website">
<meta property="og:title" content="iningwei的私家宅院">
<meta property="og:url" content="https://iningwei.github.io/page/2/index.html">
<meta property="og:site_name" content="iningwei的私家宅院">
<meta property="og:description" content="测试description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iningwei的私家宅院">
<meta name="twitter:description" content="测试description">
  
    <link rel="alternative" href="/atom.xml" title="iningwei的私家宅院" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.png">
  
  <script src="/style.js"></script>
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/img/avatar img 256.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">iningwei</a></h1>
		</hgroup>

		
		<p class="header-subtitle">其实我是学地理的</p>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/tags/随笔">随笔</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">友链</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="3" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="#" title="github">github</a>
		        
					<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
		        
					<a class="rss" target="_blank" href="#" title="rss">rss</a>
		        
					<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">iningwei</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="/img/avatar img 256.png" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">iningwei</h1>
			</hgroup>
			
			<p class="header-subtitle">其实我是学地理的</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/tags/随笔">随笔</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-Unity3D交互相关总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/06/Unity3D交互相关总结/">Unity3D交互相关总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Input.MouseButtonDown触屏、电脑通用，只要有按下操作，不需要collider</p>
<p>NGUI 中带collider的UI是可以接受到射线检测的，不过需要注意的是</p>
<pre><code>void Update()
{
    if (Input.GetMouseButtonDown(0))//
    {
        Ray ray = camera.ScreenPointToRay(Input.mousePosition);
        RaycastHit raycastHit;
        if (Physics.Raycast(ray, out raycastHit))
        {
            Debug.LogError(raycastHit.collider.name);


        }
    }
}
</code></pre><p>这里相机需要用UI相机，而不是Camera.main</p>
<p>带Collider的UI无法响应Unity自带的OnMouseDown、OnMOuseUp、OnMouseDrag事件。<br>经测试用主相机渲染的带collider的UI也无法相应上述事件</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/03/06/Unity3D交互相关总结/" class="archive-article-date">
  	<time datetime="2016-03-06T13:48:48.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-03-06</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-几种在Unity中创建AnimationCurve的方法比较" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/06/几种在Unity中创建AnimationCurve的方法比较/">几种在Unity中创建AnimationCurve的方法比较</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>以下内容均在Unity4.5版本中通过</strong></p>
<h1 id="1：使用编辑器创建动画"><a href="#1：使用编辑器创建动画" class="headerlink" title="1：使用编辑器创建动画"></a>1：使用编辑器创建动画</h1><p>假设场景中新建了一个Cube，名字为CubeTest。<br>选中该Cube, 打开Animation面板，点击AddCurve按钮,出现一个“Create New Animation”的保存框：<br><img src="/img/AnimationCurve1.png" alt="&quot;编辑器动画曲线&quot;"><br>默认情况下为Cube添加了Animator组件，<br><img src="/img/AnimationCurve2.png" alt="&quot;编辑器动画曲线&quot;"><br>同时创建了一个AnimatorController（AnimatorController的默认名字和选中的物体名字一致），一个名字为test的anim clip片段.<br><img src="/img/AnimationCurve3.png" alt="&quot;编辑器动画曲线&quot;"><br><img src="/img/AnimationCurve4.png" alt="&quot;编辑器动画曲线&quot;"><br>如图，可见Clip的属性也是和Animator中的Clip是一致的。  </p>
<p>接下来为这个Clip编辑方块在5秒钟时间内旋转52°的动画。<br><img src="/img/AnimationCurve5.png" alt="&quot;编辑器动画曲线&quot;"><br>如上图：Sample代表每秒采样的次数，图示60，则上面300代表的就是5秒时间。同时在Rotation.y处修改度数为52即可。若不使用这种方法而纯粹的通过托右边区域的红线，往往会造成误差。上图中右边区域可见黄线右边还有很多重复的灰色的线段，表示该动画是Loop循环的。若要取消该循环，可以选中该Clip，然后在Inspector面板中取消Loop Time的选项<img src="/img/AnimationCurve6.png" alt="&quot;编辑器动画曲线&quot;"> 。再刷新一下Animation面板，发现灰线消失：<br><img src="/img/AnimationCurve7.png" alt="&quot;编辑器动画曲线&quot;">  </p>
<p>若要仍使用老版本的Animation动画组件。则必须先为Cube添加Animation组件，然后再打开Animation面板-&gt;AddCurve。这个时候创建的Clip便是符合Animation组件的动画片段了。<br><img src="/img/AnimationCurve8.png" alt="&quot;编辑器动画曲线&quot;"><br>可以通过设置WrapMode来调整动画的循环方式。</p>
<h1 id="2：使用脚本创建动画"><a href="#2：使用脚本创建动画" class="headerlink" title="2：使用脚本创建动画"></a>2：使用脚本创建动画</h1><p>依旧以上述Cube为例。新建一个Cube</p>
<h2 id="2-1-AnimationCurve"><a href="#2-1-AnimationCurve" class="headerlink" title="2.1 AnimationCurve"></a>2.1 AnimationCurve</h2><h3 id="2-1-1编辑AnimationCurve"><a href="#2-1-1编辑AnimationCurve" class="headerlink" title="2.1.1编辑AnimationCurve"></a>2.1.1编辑AnimationCurve</h3><p>新建一个脚本，拖拽到Cube上。代码如下：  </p>
<pre><code>public class test : MonoBehaviour
{
    public AnimationCurve curve;

    void Start()
    {

    }

    void Update()
    {

    }
}
</code></pre><p><img src="/img/AnimationCurve11.png" alt="&quot;编辑器曲线Curve&quot;"><br>点击上述红色处，便打开AnimationCurve编辑面板  </p>
<p><img src="/img/AnimationCurve12.png" alt="&quot;编辑器曲线Curve&quot;"><br>选中一种线形后，如图  </p>
<p><img src="/img/AnimationCurve13.png" alt="&quot;编辑器曲线Curve&quot;"><br>红色区域，可以选择循环的方式，包括：Loop,Clamp,Pingpang。像1中Animation编辑界面一样，这里也可以为动画线添加Key，设置弯曲等等复杂的操作。<br>最终如图，做了一个5秒，52个单位的动画，并且动画循环方式为Pingpong。下面需要用代码把Curve对应到旋转上<br><img src="/img/AnimationCurve14.png" alt="&quot;编辑器曲线Curve&quot;"><br>最终代码如下：  </p>
<pre><code>public class test : MonoBehaviour
{
    public AnimationCurve curve;

    void Start()
    {

    }

    void Update()
    {
        transform.eulerAngles = new Vector3(0, curve.Evaluate(Time.time), 0);
    }
}
</code></pre><h3 id="2-1-2-代码创建AnimationCurve"><a href="#2-1-2-代码创建AnimationCurve" class="headerlink" title="2.1.2 代码创建AnimationCurve"></a>2.1.2 代码创建AnimationCurve</h3><p>下面使用代码来完成2.1.1中的Curve细节的创建  </p>
<pre><code>public class test : MonoBehaviour
{
    AnimationCurve curve;

    void Start()
    {
        //curve = AnimationCurve.Linear(0, 0, 5, 52);
        curve = new AnimationCurve();
        curve.AddKey(new Keyframe(0, 0));
        curve.AddKey((new Keyframe(5, 52)));
        //两种设置Curve的方式都可以。
        //第一个调用静态方法来设置（开始时间、开始值、结束时间、结束值 ）
        //第二个是先构造函数实例化Curve，然后添加Keyframe(time,value);

        curve.preWrapMode = WrapMode.Clamp;
        curve.postWrapMode = WrapMode.PingPong;
    }

    void Update()
    {
        transform.eulerAngles = new Vector3(0, curve.Evaluate(Time.time), 0);
    }
}
</code></pre><h2 id="2-2-Animation"><a href="#2-2-Animation" class="headerlink" title="2.2 Animation"></a>2.2 Animation</h2><p>可以发现上述2.1中动画的播放没有使用到Animation组件，而是使用的AnimationCurve. Evaluate(float time)方法来根据时间对应相对的值。<br>其实也可以使用Animation组件来播放动画，这里以2.1.2中的curve为例。<br>代码如下：  </p>
<pre><code>public class test : MonoBehaviour
{
    void Start()
    {
        AnimationCurve curve = AnimationCurve.Linear(0, 0, 5, 52);         

        AnimationClip clip = new AnimationClip();
        clip.wrapMode = WrapMode.Loop;
        clip.SetCurve(&quot;&quot;, typeof(Transform), &quot;localRotation.y&quot;, curve);

        animation.AddClip(clip, &quot;test&quot;);
        animation.Play(&quot;test&quot;);
    }    
}
</code></pre><p>经测试不生效，表现为y rotation瞬间从0变成180。<br>把localRotation.y改成localPosition.y可行。<br>改成localScale.y也不可行。表现为localScale.x和localScale.z变成了0。然后在y上缩放。<br>具体支持的string字符串参见文档，反正是不支持诸如rotation.y之类的。<br>搞不清楚什么原因，TODO:</p>
<h1 id="3：综合实例"><a href="#3：综合实例" class="headerlink" title="3：综合实例"></a>3：综合实例</h1><p>需要实现这样一个功能，实例化某个物体后，物体先下降，然后反弹，最后再下降到底部。<br>首先考虑到Animation编辑器，对Y轴进行编辑，结果如下  </p>
<p><img src="/img/AnimationCurve15.png" alt="&quot;编辑器曲线Curve&quot;">  </p>
<p>该图共有4个节点（0,12）,（1,3）,（1.3,12）,（3,-12）<br>然后使用该动作，问题出来了。该动作限制了Position.x为0，因此无论初始化使用这个animation clip的物体在什么地方，都会强制使得position.x变成0。<br>为了解决这个问题，必须使用程序，两套curve,一个模拟图示的曲线控制y的位置。一个用来控制x的位置为初始化位置。<br>代码如下：  </p>
<pre><code>float xPos;
void Awake()
{
    xPos = transform.position.x;
}

void Start()
{
    /*模拟Y轴上的位移动画*/
    AnimationCurve curveY = new AnimationCurve();
    curveY.AddKey(new Keyframe(0f, 12f));
    curveY.AddKey(new Keyframe(1f, 3f));
    curveY.AddKey(new Keyframe(1.3f, 12f));
    curveY.AddKey(new Keyframe(3f, -12f));
    //curveY.SmoothTangents(0,)//默认AddKey后，经测试程序里面就是按照布泽尔曲线拟合的

    /*X轴上保持初始化位置*/
    AnimationCurve curveX = new AnimationCurve();
    curveX.AddKey(new Keyframe(0f, xPos));
    curveX.AddKey(new Keyframe(3f, xPos));

    /*添加自毁函数*/
    AnimationEvent aniEvent = new AnimationEvent();
    aniEvent.functionName = &quot;DestroySelf&quot;;
    aniEvent.time = 3f;

    AnimationClip clip = new AnimationClip();
    clip.wrapMode = WrapMode.Once;
    clip.AddEvent(aniEvent);
    clip.SetCurve(&quot;&quot;, typeof(Transform), &quot;localPosition.y&quot;, curveY);
    clip.SetCurve(&quot;&quot;, typeof(Transform), &quot;localPosition.x&quot;, curveX);
    animation.AddClip(clip, &quot;supplyAnimation&quot;);
    animation.Play(&quot;supplyAnimation&quot;);

}

void DestroySelf()
{
    Destroy(gameObject);
}
</code></pre>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/03/06/几种在Unity中创建AnimationCurve的方法比较/" class="archive-article-date">
  	<time datetime="2016-03-06T12:57:45.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-03-06</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Unity3D中的多线程" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/06/Unity3D中的多线程/">Unity3D中的多线程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="/img/thread1.png" alt="&quot;Unity3D多线程&quot;"><br>如上图，通过开启一个子线程来打印，这样打印窗口既不会造成堵塞（即不会挂起后蜂涌打印，而是很平滑的依次循环打印），也不会造成update中的堵塞。<br>问题来了，若退出程序，子线程仍然在工作的话，就应该关闭子线程。网上有说设置IsBackground属性为true，可以在主线程退出时，子线程也会退出，但是试了一下不行。<br>考虑通过在OnApplicationQuit事件中，调用Abort()方法来退出线程，试了一下依旧不行，在退出主线程后，子线程依旧执行。</p>
<p><img src="/img/thread2.png" alt="&quot;Unity3D多线程&quot;">  </p>
<p>试了一下，在子线程循环中开启Thread.Sleep(一个很短的时间)，abort终止线程便生效。但这种方法肯定不可取。如图：  </p>
<p><img src="/img/thread3.png" alt="&quot;Unity3D多线程&quot;">  </p>
<p>再测试了通过bool变量来控制线程的执行，可取，如下代码：  </p>
<pre><code>bool isQuit = false;
public int maxValue = 10000;
Thread aThread;
void Awake()
{
    Debug.Log(&quot;awake trigger!&quot;);
}

void Start()
{
    Debug.Log(&quot;start trigger!&quot;);
    aThread = new Thread(new ThreadStart(DoPrint));        
    aThread.Start();
}

private void DoPrint()
{
    for (int i = 0; i &lt; maxValue; i++)//子线程执行完后其IsAlive属性变成false
    {
        if (isQuit)
        {
            return;
        }
        Debug.Log(&quot;value is:&quot; + i);
    }
}

void Update()
{
    Debug.Log(&quot;update trigger!&quot;);
}

void OnApplicationQuit()
{
    if (aThread.IsAlive)
    {
        isQuit = true;
        Debug.Log(&quot;aThread is still alive,you quit and abort&quot;);            
    }
    else
    {
        Debug.Log(&quot;aThread is null,you quit&quot;);
    }
}
</code></pre>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/03/06/Unity3D中的多线程/" class="archive-article-date">
  	<time datetime="2016-03-06T12:44:41.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-03-06</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-ogg格式转换" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/06/ogg格式转换/">ogg、ogv格式转换</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1-在线工具"><a href="#1-在线工具" class="headerlink" title="1 在线工具"></a>1 在线工具</h1><p><a href="http://www.online-convert.com/" target="_blank" rel="external">http://www.online-convert.com/</a></p>
<h1 id="2-TheoraConverter"><a href="#2-TheoraConverter" class="headerlink" title="2 TheoraConverter"></a>2 TheoraConverter</h1><p>老软件了，好几年没有更新了。<br><http: sourceforge.net="" projects="" theoraconverter="">可以下载到1.1版本的，貌似没有格式选择，测试了一下转换后为ogv格式的。<br><http: theora-converter-net.software.informer.com="" download="">这里提供的有2.6版本的，但是下载不下<br>2.6版本的多了格式选择，其它的没有详细比较。。。</http:></http:></p>
<p>我的网盘提供了1.1，2.6两个版本的 <a href="http://pan.baidu.com/s/1mhqFPri" target="_blank" rel="external">http://pan.baidu.com/s/1mhqFPri</a>  </p>
<p><img src="/img/TheoraConverter v2.6.png" alt="&quot;TheoraConverter使用截图&quot;">  </p>
<p>如图为2.6的截图，第二个选项卡“Video”里面EncodingMode默认就是Bitrate 1000<br>若用默认值，转出来的视频马赛克严重，故该值越大越好，范围为后面小括号内的值。<br>另外也可以选择Quality，默认值是6，测试结果还可以。这个值越大越清晰，当然视频的大小也会大一些。。。</p>
<h1 id="3：-iDealshare-VideoGo"><a href="#3：-iDealshare-VideoGo" class="headerlink" title="3： iDealshare VideoGo"></a>3： iDealshare VideoGo</h1><p>这个没有测试，！！！蛋疼  </p>
<p><a href="http://www.idealshare.net/video-converter/ogv-converter-for-mac-windows.html" target="_blank" rel="external">http://www.idealshare.net/video-converter/ogv-converter-for-mac-windows.html</a></p>
<h1 id="4-vcl视频播放软件和miro-Video-Conterter软件"><a href="#4-vcl视频播放软件和miro-Video-Conterter软件" class="headerlink" title="4:vcl视频播放软件和miro Video Conterter软件"></a>4:vcl视频播放软件和miro Video Conterter软件</h1><p><a href="http://www.videolan.org/" target="_blank" rel="external">http://www.videolan.org/</a>  </p>
<p><a href="http://www.mirovideoconverter.com/" target="_blank" rel="external">http://www.mirovideoconverter.com/</a>  </p>
<p>经过测试vcl和miro converter转换后的ogg（ogv）分辨率不行而且丢帧严重</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/03/06/ogg格式转换/" class="archive-article-date">
  	<time datetime="2016-03-06T07:25:17.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-03-06</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/沙里淘金/">沙里淘金</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-DontDestroyOnLoad" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/06/DontDestroyOnLoad/">DontDestroyOnLoad</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>该方法可以保证在跳转场景的时候不销毁某个物体。<br>比如场景A，场景B，场景A中有一个cube，通过在cube上添加脚本DontDestroyOnLoad,使得从A场景跳转到B场景的时候cube依旧在B场景中。这样就带来一个问题，当再次进入A场景的时候便会有两个cube，如此反复导致意外的事情。  </p>
<p>解决方法如下：  </p>
<pre><code>void Awake()
{

    DontDestroyOnLoad(this);

    if (FindObjectsOfType(GetType()).Length &gt; 1)
    {
        Destroy(gameObject);
    }
}
</code></pre>
      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/03/06/DontDestroyOnLoad/" class="archive-article-date">
  	<time datetime="2016-03-06T07:17:27.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-03-06</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Unity3D优化相关总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/05/Unity3D优化相关总结/">Unity3D优化相关总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>以下所有内容来自网络和个人日常学习、工作总结。欢迎交流：546722522</p>
<h1 id="Google-IO-2014-Unity游戏优化"><a href="#Google-IO-2014-Unity游戏优化" class="headerlink" title="Google_IO_2014_Unity游戏优化"></a>Google_IO_2014_Unity游戏优化</h1><p>很好的一个国外Unity优化指南，提供了一些更深层次的优化指南。<br>PPT下载地址：<a href="http://pan.baidu.com/s/1hreCzoo" target="_blank" rel="external">http://pan.baidu.com/s/1hreCzoo</a></p>
<p>GPU瓶颈可以根据GPU类型选择合适的工具来进行分析：<br><img src="/img/gpu tools.png" alt="&quot;GPU分析工具&quot;">  </p>
<p>CPU时间衡量：<br>通过Profiler检查Camera.Render的时间<br>创建脚本，使用OnPreCull、OnPostRender、OnGUI来具体分析<br>OnPreCull是时间戳的开始、OnPostRender是时间戳的结束、OnGUI用来显示结果</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/03/05/Unity3D优化相关总结/" class="archive-article-date">
  	<time datetime="2016-03-05T14:22:19.000Z" itemprop="datePublished"><i class="icon-clock"></i>2016-03-05</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Unity3D mecanim杂记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/04/Unity3D mecanim杂记/">Unity3D mecanim杂记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>以下皆以4.5左右版本Unity3D为准</p>
<h1 id="1：Layer"><a href="#1：Layer" class="headerlink" title="1：Layer"></a>1：Layer</h1><p>Mecanim的layer可以在一个角色上播放超过一个动画。<br>较高的layer会盖过下面的layer, 不过layer 0以外的layer weight预设是0, 要set为1才会播放。<br>例如layer 0是站立或跑走的动画 layer 1是 挥剑的动画<br>用body mask控制layer 1只影响上半身<br>脚本中要挥剑就 Animator.SetLayerWeight(1,1f);<br>完成后Animator.SetLayerWeight(1,0f); </p>
<p>base layer以上的新layer初始的weight值是0, 一定要用script將weight改成1才可以播动画<br>当base layer和new layer同時播放影响同一关节的动画时,会只播放层数高的layer  </p>
<p>这些后来增加的层的权重在运行的时候默认是0的，也就是没有影响，需要自己在初始化的时候或者特定需要的时候设定层的权重。（使用animator.SetLayerWeight）</p>
<p><a href="http://docs.unity3d.com/Documentation/Components/class-AvatarBodyMask.html/" target="_blank" rel="external">http://docs.unity3d.com/Documentation/Components/class-AvatarBodyMask.html/</a><br><a href="http://docs.unity3d.com/Documentation/Manual/AnimationLayers.html/" target="_blank" rel="external">http://docs.unity3d.com/Documentation/Manual/AnimationLayers.html/</a></p>
<h1 id="2：AnimatorStateInfo"><a href="#2：AnimatorStateInfo" class="headerlink" title="2：AnimatorStateInfo"></a>2：AnimatorStateInfo</h1><pre><code>AnimatorStateInfo stateInfo = animator.GetCurrentAnimatorStateInfo(0);
if (stateInfo.IsName(&quot;Base Layer.RifleIdle&quot;))
{
    //Debug.Log(&quot;stateInfo.length:&quot; + stateInfo.length);
    //Debug.Log(&quot;stateInfo.normalizedTime:&quot; + stateInfo.normalizedTime);
    //if (stateInfo.normalizedTime &gt;= stateInfo.length)
    if (stateInfo.normalizedTime &gt;= 0.01f)
    {
        gun.transform.parent = leftHand.transform;//先设置父子关系，再设置位置和旋转。否则会出现闪烁。
        gun.transform.localPosition = leftHandLocalPos;
        gun.transform.localRotation = Quaternion.Euler(leftHandLocalRotation);
    }
}
</code></pre><p>Animator.GetCurrentAnimatorStateInfo（int layerIndex）//注意该函数最好在update中调用，返回的才是当前实时的animatorStateInfo。若放在Start函数中调用的话，获得的只是启动时候的状态~</p>
<p><strong>AnimatorStateInfo.normalizedTime</strong><br>Normalized time of the State.<br>The integer part is the number of time a state has been looped. The fractional part is the % (0-1) of progress in the current loop<br><img src="/img/normalized time.png" alt="normalized time"></p>
<p><strong>AnimatorStateInfo.length</strong><br>Current duration of the state.<br>In seconds Can vary when the State contains a Blend Tree.</p>
<h1 id="3：Animation-Clip-Inspector"><a href="#3：Animation-Clip-Inspector" class="headerlink" title="3：Animation Clip Inspector"></a>3：Animation Clip Inspector</h1><p><a href="http://docs.unity3d.com/Documentation/Manual/RootMotion.html/" target="_blank" rel="external">http://docs.unity3d.com/Documentation/Manual/RootMotion.html/</a><br><a href="http://docs.unity3d.com/Documentation/Components/class-AnimationClip.html/" target="_blank" rel="external">http://docs.unity3d.com/Documentation/Components/class-AnimationClip.html/</a><br><img src="/img/animation clip inspector.png" alt="Animation clip inspector"><br>Bake Into pose勾选后，人物就不能跟随动画进行位置的改变相应。<br>不勾选，人物可以跟随动画进行相应位置的改变。</p>
<h1 id="4：Overriding-Root-Motion"><a href="#4：Overriding-Root-Motion" class="headerlink" title="4：Overriding Root Motion"></a>4：Overriding Root Motion</h1><p><strong>MonoBehaviour.OnAnimatorMove()</strong><br>Callback for processing animation movements for modifying root motion.<br>This callback will be invoked at each frame after the state machines and the animations have been evaluated, but before OnAnimatorIK.</p>
<pre><code>public class Example : MonoBehaviour {
    void OnAnimatorMove() {
          Animator animator = GetComponent&lt;Animator&gt;();
        if (animator) {
            Vector3 newPosition = transform.position;
            newPosition.z += animator.GetFloat(&quot;Runspeed&quot;) * Time.deltaTime;
            transform.position = newPosition;
        }    
    }
}
</code></pre><p>一个常规的通过characterController控制移动的写法:  </p>
<pre><code>void OnAnimatorMove()
{
    Vector3 deltaPosition = animator.deltaPosition;
    if (controller.isGrounded)
    {
        xVelocity = animator.GetFloat(&quot;Speed&quot;) * controller.velocity.x * 0.25f;
        zVelocity = animator.GetFloat(&quot;Speed&quot;) * controller.velocity.z * 0.25f;
    }
    verticalSpeed += Physics.gravity.y * Time.deltaTime;
    if (verticalSpeed &lt;= 0)
    {
        animator.SetBool(&quot;Jump&quot;, false);
    }

    deltaPosition.y = verticalSpeed * Time.deltaTime;
    if (!controller.isGrounded)
    {
        deltaPosition.x = xVelocity * Time.deltaTime;
        deltaPosition.z = zVelocity * Time.deltaTime;
    }
    controller.Move(deltaPosition);

    if ((controller.collisionFlags &amp; CollisionFlags.Below) != 0)
    {
        verticalSpeed = 0;
    }

    transform.rotation = animator.rootRotation;
}
</code></pre><h1 id="5-OnAnimatorIK-int-layerIndex"><a href="#5-OnAnimatorIK-int-layerIndex" class="headerlink" title="5 :OnAnimatorIK(int layerIndex)"></a>5 :OnAnimatorIK(int layerIndex)</h1><p>常用方法：<br>animator.SetIKPosition(AvatarIKGoal.LeftHand,…);<br>animator.SetIKPositionWeight();</p>
<p>animator.SetIKRotation<br>animator.SetIKRotationWeight</p>
<p>animator.SetLookAtPosition<br>animator.SetLookAtWeight
 </p>
<h1 id="6：一些技巧："><a href="#6：一些技巧：" class="headerlink" title="6：一些技巧："></a>6：一些技巧：</h1><h2 id="6-1：控制blendTree中motion的动画速度"><a href="#6-1：控制blendTree中motion的动画速度" class="headerlink" title="6.1：控制blendTree中motion的动画速度"></a>6.1：控制blendTree中motion的动画速度</h2><p><img src="/img/blend tree1.png" alt="blend tree1"><br>FireStatus参数控制，是蹲下射击还是站立射击。</p>
<p><img src="/img/blend tree2.png" alt="blend tree2"><br>如上图，通过修改绿色圈的速度可以修改该动画的播放速度，从而提高射击速度。但是目前版本4.3还没有提供直接的api用代码控制它。虽然可以通过设置animator.Speed来整体提高速度，但是会影响到其它动画，可控性很低。<br>可以通过每个动画单独设置一个blendTree,该blendTree使用两个motion,且这两个motion都添加这个动画，然后设置最低速度、最大速度。然后用一个float型变量控制在这两个motion之间切换。如下图：  </p>
<p><img src="/img/blend tree3.png" alt="blend tree3">  </p>
<p><img src="/img/blend tree4.png" alt="blend tree4"><br>这样在程序里结合使用FireSpeed参数来控制射击速度了。</p>
<h2 id="6-2：动画覆盖时候的参数设置解决覆盖扭曲的问题，如站立射击，跑动射击"><a href="#6-2：动画覆盖时候的参数设置解决覆盖扭曲的问题，如站立射击，跑动射击" class="headerlink" title="6.2：动画覆盖时候的参数设置解决覆盖扭曲的问题，如站立射击，跑动射击"></a>6.2：动画覆盖时候的参数设置解决覆盖扭曲的问题，如站立射击，跑动射击</h2><p>这里以站立射击，跑动射击为例说明。涉及到的动作有：站立idle状态，站立射击状态，跑动瞄准状态，跑动射击状态。如下图（跑动射击和跑动瞄准不容易区分这里不示意了）。</p>
<p><img src="/img/shoot model.png" alt="模型动作示例图"><br>常规做法是站立、跑动放一个layer，射击动作新建一个layer，通过mask，使得下半身不动。调整weight为1，使得射击动作的层覆盖weight较低的层（base layer的weight为0），这里注意一点，weight不一定设置为1，weight值越高则可以覆盖低weight的动作，而且weight值还形象自身动作的力度，weight=1,则按照最大动作幅度表现动作，weight=0.5则动作幅度只有原来的一半。<br>需要注意射击层的Blending属性。  </p>
<p><img src="/img/mask blending type.png" alt="mask blending type"><br>Additive是在原来动作的基础上只添加新的动作。<br>Override是覆盖原来动作。<br>如从站立过渡到站立射击状态，若这里选择的是Additive。相对于站立动作，射击动作就一个手部的抖动，因此现在的动作就是站立手部抖动，看起来蛋疼且莫名其妙。若选择的是Override,一切完好。若非要用Additive不可，那么还需要一个站立瞄准的动作，切换到射击状态前，确保人物已经切换到站立瞄准的状态了，这样在站立瞄准的基础上Additive的射击就不会蛋疼了。<br>跑动射击的话，我们在跑动瞄准的基础上Additive射击的动作自然没有问题，问题是若使用Override方式的话，很蛋疼。上半身枪口的指向不再是正前方。。。个人猜测是跑动瞄准的脊柱和射击动作的脊柱不一致吧。。。</p>
<h2 id="6-3：RootTransform-Rotation-BasedUpon参数设置"><a href="#6-3：RootTransform-Rotation-BasedUpon参数设置" class="headerlink" title="6.3：RootTransform Rotation   BasedUpon参数设置"></a>6.3：RootTransform Rotation   BasedUpon参数设置</h2><p><img src="/img/root transform rotation basedupon.png" alt="BasedUpon参数"><br>Original的提示是：Keep the rotation as it is authored in the source file<br>Body Oritation的提示是：Keeps the upper body pointing forward</p>
<h2 id="6-4-不要把Unity3D工程A中的中的fbx文件拷贝供其它工程使用"><a href="#6-4-不要把Unity3D工程A中的中的fbx文件拷贝供其它工程使用" class="headerlink" title="6.4 不要把Unity3D工程A中的中的fbx文件拷贝供其它工程使用"></a>6.4 不要把Unity3D工程A中的中的fbx文件拷贝供其它工程使用</h2><p>这样做在另一个工程中会出现很多意想不到的现象，别的工程要用的话，必须使用源fbx文件。</p>
<h2 id="6-5-Mask-Curves-Events"><a href="#6-5-Mask-Curves-Events" class="headerlink" title="6.5 Mask,Curves, Events"></a>6.5 Mask,Curves, Events</h2><p>具体哪个版本的Unity3D为导入的动作加入了这几个东西，已经记不得了。</p>
<h3 id="6-5-1-Mask"><a href="#6-5-1-Mask" class="headerlink" title="6.5.1 Mask"></a>6.5.1 Mask</h3><p>略</p>
<h3 id="6-5-2-Curves"><a href="#6-5-2-Curves" class="headerlink" title="6.5.2 Curves"></a>6.5.2 Curves</h3><p>Curves和Events都是一个动作上可以添加多个的。<br>Curves通过添加曲线来控制动画各个部位的播放速度。<br>一个动作添加了多个Curve的话，会取均值？？<br>如下图添加了一个叫做RollCurve的Curve，若动作的Animator Controller也声明了float型的“RollCurve”动作，则这个两个便挂钩了。在程序中可以获得当前Curve的值<br><img src="/img/add curves.png" alt="add curves"><br>Debug.Log(“rollCurveValue is:”+animator.GetFloat(“RollCurve”));<br>详见：<a href="http://docs.unity3d.com/Documentation/Manual/AnimatorCurves.html/" target="_blank" rel="external">http://docs.unity3d.com/Documentation/Manual/AnimatorCurves.html/</a></p>
<h3 id="6-5-3-Events"><a href="#6-5-3-Events" class="headerlink" title="6.5.3 Events"></a>6.5.3 Events</h3><p>可以为动作添加事件，当动作运行到添加事件的时间点后，会触发事件的执行，同样一个动作上可以添加多个事件，满足条件的时候都会执行的。<br><img src="/img/add many events.png" alt="add many events"><br>下图为添加事件的窗口。Function后的textbox对应动作控制脚本上的函数名称，该函数对public还是private没有要求，但是该函数只能带0个或者1个参数，参数类型如下图。<br><img src="/img/Add events.png" alt="Add events"></p>
<h2 id="6-6-Any-State-gt-Death需要注意的事项"><a href="#6-6-Any-State-gt-Death需要注意的事项" class="headerlink" title="6.6 Any State-&gt;Death需要注意的事项"></a>6.6 Any State-&gt;Death需要注意的事项</h2><p>默认从Any State到其它状态添加了动作转换过渡后，默认条件如下图：<br><img src="/img/any state 2 death.png" alt="any state 2 death"><br>但是该条件一运行便会执行。于是我们想通过某个bool变量如isDeath来控制，于是删除Exit Time这个条件，只使用bool变量来控制。结果是动作会来回一直闪烁，非常奇怪。解决方案是保留该Exit Time条件，根据需要 调节后面的时间，然后结合bool变量来控制</p>
<h2 id="6-7-移除动作模型保留动作文件，无法减少占用空间"><a href="#6-7-移除动作模型保留动作文件，无法减少占用空间" class="headerlink" title="6.7 移除动作模型保留动作文件，无法减少占用空间"></a>6.7 移除动作模型保留动作文件，无法减少占用空间</h2><p>由于要在unity3d中调相关的参数，一般从3dsmax中导出的fbx都是带有模型的动作。在unity3d中做好一切工作后，想着可以ctrl+d把动作文件从模型中复制出来（选中动作文件，ctrl+d会自动复制一个到project目录中），然后删除原来的模型，达到减少安装包大小的目地。事实上测试了，无法。Unity其实已经做了相关的优化的，打包的时候打入的就是动作文件， 而不是包括冗余的模型。<br>需要注意的是，再修改相关参数的话就没法了…需要重新导入模型文件…<br>另一方面，6.5中提到的设置的events事件在模型文件被删除后依旧会保留的，只是我们看不到了，无法编辑了而已！~~</p>
<h2 id="6-8-SetBool和SetTrigger函数比较，以及bool变量和trigger变量比较"><a href="#6-8-SetBool和SetTrigger函数比较，以及bool变量和trigger变量比较" class="headerlink" title="6.8 SetBool和SetTrigger函数比较，以及bool变量和trigger变量比较"></a>6.8 SetBool和SetTrigger函数比较，以及bool变量和trigger变量比较</h2><p>Unity4.3在animator面板内引入了Trigger这个变量（以前只有int ,float,bool三种）</p>
<h3 id="6-8-1-SetBool-SetTrigger函数"><a href="#6-8-1-SetBool-SetTrigger函数" class="headerlink" title="6.8.1 SetBool,SetTrigger函数"></a>6.8.1 SetBool,SetTrigger函数</h3><p>在animator界面要是需要用一个bool变量（这里以bool IsAttack为例）来控制动画的来回切换就要先设置IsAttack为true，然后在适当的时候设置为false。<br>如何获取适当的时候呢？一般都是通过animator.GetCurrentAnimatorStateInfo来获取当前的动画播放信息。<br>SetBool比较简单，代码如下：  </p>
<pre><code>stateInfo0 = animator.GetCurrentAnimatorStateInfo(0);
if(stateInfo0.IsName(&quot;Base Layer.Attack&quot;))
{
    if(stateInfo0.normalizedTime&gt;0.9f)
    {
        animator.SetBool(&quot;IsAttack&quot;,false);
    }
}
if(Input.GetKeyDown(KeyCode.A))
{
    animator.SetBool(&quot;IsAttack&quot;,true);
}
</code></pre><p>SetTrigger代码如下（这里用SetTrigger来操纵animator界面中声明为bool类型的变量，发现竟然可以操纵）：  </p>
<pre><code>stateInfo0 = animator.GetCurrentAnimatorStateInfo(0);
if(stateInfo0.IsName(&quot;Base Layer.Attack&quot;))
{
    if(stateInfo0.normalizedTime&gt;0.9f)
    {
        animator.SetBool(&quot;IsAttack&quot;,false);
    }
}
if(Input.GetKeyDown(KeyCode.A))
{
    animator.SetTrigger(&quot;IsAttack&quot;);
}
</code></pre><p>SetTrigger实质其实就是设置了IsAttack为true了。但事实上SetTrigger函数是用来操纵Trigger类型变量的。如下介绍</p>
<h3 id="6-8-2-Bool变量，Trigger变量"><a href="#6-8-2-Bool变量，Trigger变量" class="headerlink" title="6.8.2 Bool变量，Trigger变量"></a>6.8.2 Bool变量，Trigger变量</h3><p><a href="http://answers.unity3d.com/questions/600268/mecanim-animation-parameter-types-boolean-vs-trigg.html/" target="_blank" rel="external">http://answers.unity3d.com/questions/600268/mecanim-animation-parameter-types-boolean-vs-trigg.html/</a><br>这里有讨论。<br>下图为使用Trigger变量作为条件的截图，它不像Bool变量那样有true，false之分。<br><img src="/img/trigger inspector.png" alt="trigger inspector"><br>通过使用SetTrigger函数，可以先设置Tigger变量的值为true,使得进入另一个状态，然后立马Tigger变量又变为false。这样就不用像SetBool函数那边，还要考虑在合适的时候设置为false的问题。<br>比如人物从Idle状态到攻击状态，通过Tigger类型变量isAttack来控制。<br>从Idle到攻击，用isAttack来控制。这样我们进入攻击后，该变量又回到false。<br>攻击再回到Idle,用ExistTime来控制。这样就比较好的解决了问题。</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2015/10/04/Unity3D mecanim杂记/" class="archive-article-date">
  	<time datetime="2015-10-04T13:33:03.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-10-04</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Unity3D bug积累" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/03/Unity3D bug积累/">Unity3D bug积累</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1：mp3没有声音<br>如图：导入到场景中的mp3格式的音乐在预览界面点击播放，听不到声音。但是用外部播放器打开对应文件夹下的该文件却有声音的。<br>把文件删除、重新导入，依旧没有声音。<br>最后重启Unity3D，尼玛，可以了。。。这个BUG，3年前就存在了。。</p>
<p>2:图片导入后Could not create texture from XXXX;File could not be read.<br>无论是直接复制粘贴到unity3d文件夹内还是用import都报错如下。图片是白色的，不显示内容。<br><img src="/img/unity pic bug.png" alt="图片显示白色"><br>解决方法：用photoshop打开，重新保存一道。可能是编码的问题吧~~~</p>
<p>2：Build Problem - asset is marked as don’t save<br>20140512（汶川六年）<br>今天做电影学院3D互动项目，切换为成android平台后，build and run的时候报了一些列错。如下图：<br>Error 1:<br>An asset is marked as dont save, but is included in the build:<br>UnityEditor.HostView:OnGUI()<br>Error 2:<br>Building - Failed to write file: sharedassets0.assets UnityEditor.HostView:OnGUI()<br>Error 3:<br>Error building Player: Couldn’t build player because of unsupported data on target platform.</p>
<p>这是论坛上对该问题的讨论：<a href="http://answers.unity3d.com/answers/706282/view.html" target="_blank" rel="external">http://answers.unity3d.com/answers/706282/view.html</a><br>我关闭unity后，重新打开。问题消失</p>
<p>3:Profiler LogStringToConsole<br>Necromancy项目，主角死亡后，复活后帧率极度下降，打开profiler<br><img src="/img/profiler log.png" alt="profiler示图">  </p>
<p>发现FriendAnimationControl.cs脚本中的debug占用了几乎全部的内存消耗。<br>问题是FriendAnimationControl.cs上的脚本已经完全注释了Debug.Log以及Printf了。<br>最终终于找到原因：<a href="http://forum.unity3d.com/threads/profiler-showing-logstringtoconsole-what-is-that.237589/#post-1577507" target="_blank" rel="external">http://forum.unity3d.com/threads/profiler-showing-logstringtoconsole-what-is-that.237589/#post-1577507</a>  </p>
<p><img src="/img/unity answer.png" alt="解释">  </p>
<p><img src="/img/OpenEditorLog.png" alt="打开Editor Log"><br>如上图，在Console面板点击Open Editor Log<br>在详细的Editor Log中发现了很多句如下信息：<br>!(Log信息)[/img/LogClear.png]<br>这些信息，被当作垃圾debug信息，没有显示在Console的面板中，只能通过Log日志看到。<br>于是追本溯源，在FriendAnimationControl.cs脚本中发现在主角死亡的时候设置了<code>animator.runtimeAnimatorController = null;</code><br>导致主角复活后，友军继续执行animator.SetBool之类的操作，报错Animator has not been initialized。可惜的是该报错被当作垃圾信息了……</p>
<p>4: Shader wants normals, but the mesh XXX doesn’t have them的警告</p>
<p><img src="/img/shader want normals.png" alt="shader wants normals">  </p>
<p>找到名为XXX的mesh，发现其用的shader 是diffuse，根本不需要法线贴图。<br>再仔细看看，这个XXX mesh是用代码生成的。于是最后调用了RecalculateNormals()方法，顺利解决。（_trailMesh.RecalculateNormals()）;</p>
<p>5：Setting the parent of a transform which resides in a prefab is disabled to prevent data corruption<br>出现情况描述：Resource.Load了一个Prefab,并as强制转换为GameObject类型bb。然后设置bb的父物体为场景中已知的物体。报错如上。<br>解决方法：还必须Instantiate一下bb，并存到cc中,然后就可以随便操纵cc了，不会发生上述报错：<br>GameObject bb=Resources.Load(XXX) as GameObject;<br>GameObject cc=Instantiate(bb);</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2015/10/03/Unity3D bug积累/" class="archive-article-date">
  	<time datetime="2015-10-03T10:47:28.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-10-03</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Unity3D Navmesh杂记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/03/Unity3D Navmesh杂记/">Unity3D Navmesh杂记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="1：navmesh-agent和character-controller"><a href="#1：navmesh-agent和character-controller" class="headerlink" title="1：navmesh agent和character controller"></a>1：navmesh agent和character controller</h1><p>当使用navmesh要实现物体不和其余collider碰撞需要为物体添加collider组件。<br>但是添加了collider后，会发现相机抖动厉害。<br>经测试是navmesh agent和character controller之间的冲突，但是程序需要又不能删除某一个，故考虑动态关闭一个即可。<br>故程序中根据情况，对navmesh agent进行enable的开关</p>
<h1 id="2：判断是否到达目标点destination"><a href="#2：判断是否到达目标点destination" class="headerlink" title="2：判断是否到达目标点destination"></a>2：判断是否到达目标点destination</h1><p>当设置了navMeshAgent.destination后，如何判断是否到达目标点，由于api中没提供直接的接口<br>经过测试实时获得当前物体和目标的距离来进行判断：<br>Vector3.Distance(transform.position, navMeshAgent.destination) &lt; 0.5f<br>PS:api中提供有remainingDistance接口用来获得距离目标点还有多远的距离。但是该接口在刚设置destination后获得的距离也是0。因此基本不可取<br>PS2:也可以用： navMeshAgent.path.corners.Length == 1，但是有时候会失效。法科</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2015/10/03/Unity3D Navmesh杂记/" class="archive-article-date">
  	<time datetime="2015-10-03T10:28:08.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-10-03</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-Unity3D优化总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/10/03/Unity3D优化总结/">Unity3D优化总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>不要使用OnGUI()，它很慢，非常慢。</li>
<li>当需要频繁修改物体的localScale时，移除其collider组件，否则会非常影响帧率。</li>
<li>使用OnBecameVisible()/OnBecameInvisible()配对使用修改enabled属性，使得只有在对象可见时脚本才会执行。<br>（物体不可见的时候drawcall是降低了，但是若自身带有脚本，还是执行的~~~）</li>
<li>使用InvokeRepeating()代替Update()处理不需要实时的数据更新。</li>
<li>使用对象池GameObjectPool缓存频繁使用的对象。</li>
</ol>
<p>IOS平台优化建议<br>•    Keep vertex count below:<br>•    40K per frame when targeting iPhone 3GS and newer devices (with SGX GPU)<br>•    10K per frame when targeting older devices (with MBX GPU)<br>•    Keep the number of different materials per scene low - share as many materials between different objects as possible.<br>•    Set Static property on a non-moving objects to allow internal optimizations.<br>•    Use PVRTC formats for textures when possible, otherwise choose 16bit textures over 32bit.<br>•    Use combiners or pixel shaders to mix several textures per fragment instead of multi-pass approach.<br>•    If writing custom shaders, always use smallest possible floating-point types:<br>•    fixed / lowp – perfect for color, lighting information and normals,<br>•    half / mediump – for texture UV coordinates,<br>•    float / highp – avoid in pixel shaders, fine to use in vertex shader for vertex position calculations.<br>•    Minimize use of complex mathematical operations such as pow, sin, cos etc in pixel shaders.<br>•    Do not use Pixel Lights when it is not necessary – choose to have only a single (preferably directional) pixel light affecting your geometry.<br>•    Do not use dynamic lights when it is not necessary – choose baking lighting instead.<br>•    Choose to use less textures per fragment.<br>•    Avoid alpha-testing, choose alpha-blending instead.<br>•    Do not use fog when it is not necessary.<br>•    Learn benefits of Occlusion culling and use it to reduce amount of visible geometry and draw-calls in case of complex static scenes with lots of occlusion. Plan your levels to benefit from Occlusion culling.<br>•    Use skyboxes to “fake” distant geometry.<br>更多优化相关的知识：官网<br><a href="http://docs.unity3d.com/Documentation/Manual/OptimizingGraphicsPerformance.html" target="_blank" rel="external">http://docs.unity3d.com/Documentation/Manual/OptimizingGraphicsPerformance.html</a>
 </p>
<h1 id="Modeling-Characters-for-Optimal-Performance"><a href="#Modeling-Characters-for-Optimal-Performance" class="headerlink" title="Modeling Characters for Optimal Performance"></a>Modeling Characters for Optimal Performance</h1><p>Below are some tips for designing character models to give optimal rendering speed.</p>
<h2 id="Use-a-Single-Skinned-Mesh-Renderer"><a href="#Use-a-Single-Skinned-Mesh-Renderer" class="headerlink" title="Use a Single Skinned Mesh Renderer"></a>Use a Single Skinned Mesh Renderer</h2><p>You should use only a single skinned mesh renderer for each character. Unity optimizes animation using visibility culling and bounding volume updates and these optimizations are only activated if you use one animation component and one skinned mesh renderer in conjunction. The rendering time for a model could roughly double as a result of using two skinned meshes in place of a single mesh and there is seldom any practical advantage in using multiple meshes.</p>
<h2 id="Use-as-Few-Materials-as-Possible"><a href="#Use-as-Few-Materials-as-Possible" class="headerlink" title="Use as Few Materials as Possible"></a>Use as Few Materials as Possible</h2><p>You should also keep the number of materials on each mesh as low as possible. The only reason why you might want to have more than one material on a character is that you need to use different shaders for different parts (eg, a special shader for the eyes). However, two or three materials per character should be sufficient in almost all cases.</p>
<h2 id="Use-as-Few-Bones-as-Possible"><a href="#Use-as-Few-Bones-as-Possible" class="headerlink" title="Use as Few Bones as Possible"></a>Use as Few Bones as Possible</h2><p>A bone hierarchy in a typical desktop game uses somewhere between fifteen and sixty bones. The fewer bones you use, the better the performance will be. You can achieve very good quality on desktop platforms and fairly good quality on mobile platforms with about thirty bones. Ideally, keep the number below thirty for mobile devices and don’t go too far above thirty for desktop games.</p>
<h2 id="Polygon-Count"><a href="#Polygon-Count" class="headerlink" title="Polygon Count"></a>Polygon Count</h2><p>The number of polygons you should use depends on the quality you require and the platform you are targeting. For mobile devices, somewhere between 300 and 1500 polygons per mesh will give good results, whereas for desktop platforms the ideal range is about 1500 to 4000. You may need to reduce the polygon count per mesh if the game can have lots of characters onscreen at any given time. As an example, Half Life 2 used 2500-5000 triangles per character. Current AAA games running on the PS3 or Xbox 360 usually have characters with 5000-7000 triangles.</p>
<h2 id="Keep-Forward-and-Inverse-Kinematics-Separate"><a href="#Keep-Forward-and-Inverse-Kinematics-Separate" class="headerlink" title="Keep Forward and Inverse Kinematics Separate"></a>Keep Forward and Inverse Kinematics Separate</h2><p>When animations are imported, a model’s inverse kinematic (IK) nodes are baked into forward kinematics (FK) and as a result, Unity doesn’t need the IK nodes at all. However, if they are left in the model then they will have a CPU overhead even though they don’t affect the animation. You can delete the redundant IK nodes in Unity or in the modeling tool, according to your preference. Ideally, you should keep separate IK and FK hierarchies during modeling to make it easier to remove the IK nodes when necessary.</p>
<h2 id="Simple-Checklist-to-make-Your-Game-Faster"><a href="#Simple-Checklist-to-make-Your-Game-Faster" class="headerlink" title="Simple Checklist to make Your Game Faster"></a>Simple Checklist to make Your Game Faster</h2><p>•    Keep vertex count below 200K..3M per frame when targetting PCs, depending on the target GPU<br>•    If you’re using built-in shaders, pick ones from Mobile or Unlit category. They work on non-mobile platforms as well; but are simplified and approximated versions of the more complex shaders.<br>•    Keep the number of different materials per scene low - share as many materials between different objects as possible.<br>•    Set Static property on a non-moving objects to allow internal optimizations like static batching.<br>•    Do not use Pixel Lights when it is not necessary - choose to have only a single (preferably directional) pixel light affecting your geometry.<br>•    Do not use dynamic lights when it is not necessary - choose to bake lighting instead.<br>•    Use compressed texture formats when possible, otherwise prefer 16bit textures over 32bit.<br>•    Do not use fog when it is not necessary.<br>•    Learn benefits of Occlusion Culling and use it to reduce amount of visible geometry and draw-calls in case of complex static scenes with lots of occlusion. Plan your levels to benefit from ccclusion culling.<br>•    Use skyboxes to “fake” distant geometry.<br>•    Use pixel shaders or texture combiners to mix several textures instead of a multi-pass approach.<br>•    If writing custom shaders, always use smallest possible floating point format:<br>o    fixed / lowp - for colors, lighting information and normals,<br>o    half / mediump - for texture UV coordinates,<br>o    float / highp - avoid in pixel shaders, fine to use in vertex shader for position calculations.<br>•    Minimize use of complex mathematical operations such as pow, sin, cos etc. in pixel shaders.<br>•    Choose to use less textures per fragment.</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2015/10/03/Unity3D优化总结/" class="archive-article-date">
  	<time datetime="2015-10-03T10:23:27.000Z" itemprop="datePublished"><i class="icon-clock"></i>2015-10-03</time>
</a>
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags"></i>
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity3D/">Unity3D</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<i class="icon-price-tags"></i>
	<a class="article-category-link" href="/categories/查漏补缺/">查漏补缺</a>
	</div>


      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018 iningwei
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
      <li data-hook="tools-section-friends"><span class="text">友链</span><i class="icon-link"></i></li>
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				<a href="/tags/NET/" style="font-size: 10px;">.NET</a> <a href="/tags/3DSMax/" style="font-size: 10px;">3DSMax</a> <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/C/" style="font-size: 16px;">C#</a> <a href="/tags/NShader/" style="font-size: 10px;">NShader</a> <a href="/tags/Shader/" style="font-size: 12px;">Shader</a> <a href="/tags/Unity3D/" style="font-size: 20px;">Unity3D</a> <a href="/tags/Visual-Studio/" style="font-size: 10px;">Visual Studio</a> <a href="/tags/cg/" style="font-size: 18px;">cg</a> <a href="/tags/lua/" style="font-size: 10px;">lua</a> <a href="/tags/ulua/" style="font-size: 10px;">ulua</a> <a href="/tags/反射/" style="font-size: 10px;">反射</a> <a href="/tags/堆栈/" style="font-size: 12px;">堆栈</a> <a href="/tags/安卓/" style="font-size: 10px;">安卓</a> <a href="/tags/小众软件/" style="font-size: 10px;">小众软件</a> <a href="/tags/工具/" style="font-size: 10px;">工具</a> <a href="/tags/插件/" style="font-size: 10px;">插件</a> <a href="/tags/操作系统使用/" style="font-size: 10px;">操作系统使用</a> <a href="/tags/沙里淘金/" style="font-size: 10px;">沙里淘金</a> <a href="/tags/热更新/" style="font-size: 12px;">热更新</a> <a href="/tags/编辑器扩展/" style="font-size: 10px;">编辑器扩展</a> <a href="/tags/视频/" style="font-size: 10px;">视频</a> <a href="/tags/软件安装/" style="font-size: 14px;">软件安装</a>
    			</div>
    	</section>
    

    
    	<section class="tools-section tools-section-friends">
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me">
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>